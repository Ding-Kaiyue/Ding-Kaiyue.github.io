<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Ding Kaiyue&#39;s Blog</title>
  
  <subtitle>ä¸è¦æ³¨æ»¡ä¸€æ¡¶æ°´ï¼Œè€Œè¦ç‚¹ç‡ƒä¸€æŠŠç«</subtitle>
  <link href="http://ding-kaiyue.github.io/atom.xml" rel="self"/>
  
  <link href="http://ding-kaiyue.github.io/"/>
  <updated>2025-11-03T00:56:48.325Z</updated>
  <id>http://ding-kaiyue.github.io/</id>
  
  <author>
    <name>Ding Kaiyue</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>ä»ç¡¬ç¼–ç åˆ°æ’ä»¶åŒ–ï¼ˆä¸‹ç¯‡ï¼‰ï¼šæ¸…æ´æ¶æ„çš„è®¾è®¡ä¸å®ç°</title>
    <link href="http://ding-kaiyue.github.io/2025/11/01/%E4%BB%8E%E7%A1%AC%E7%BC%96%E7%A0%81%E5%88%B0%E6%8F%92%E4%BB%B6%E5%8C%96%EF%BC%88%E4%B8%8B%E7%AF%87%EF%BC%89%EF%BC%9A%E6%B8%85%E6%B4%81%E6%9E%B6%E6%9E%84%E7%9A%84%E8%AE%BE%E8%AE%A1%E4%B8%8E%E5%AE%9E%E7%8E%B0/"/>
    <id>http://ding-kaiyue.github.io/2025/11/01/%E4%BB%8E%E7%A1%AC%E7%BC%96%E7%A0%81%E5%88%B0%E6%8F%92%E4%BB%B6%E5%8C%96%EF%BC%88%E4%B8%8B%E7%AF%87%EF%BC%89%EF%BC%9A%E6%B8%85%E6%B4%81%E6%9E%B6%E6%9E%84%E7%9A%84%E8%AE%BE%E8%AE%A1%E4%B8%8E%E5%AE%9E%E7%8E%B0/</id>
    <published>2025-11-01T10:33:00.000Z</published>
    <updated>2025-11-03T00:56:48.325Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>åœ¨ä¸Šç¯‡ä¸­ï¼Œæˆ‘ä»¬ä¸€èµ·ç»å†äº†é‚£æ®µæ··ä¹±çš„æ—¥å­â€”â€”å‡½æ•°ä¸Šåƒè¡Œã€æ¨¡å¼äº’ç›¸å¹²æ‰°ã€æ”¹ä¸€å¤„å´©å…¨å±€ã€‚</p><p>æœ¬ç¯‡ï¼Œæˆ‘ä»¬å°†äº²æ‰‹æ‹†è§£å¹¶é‡å»ºè¿™ä¸€åˆ‡ï¼šä»æ··ä¹±åˆ°æ¸…æ™°ï¼Œä»ç¡¬ç¼–ç åˆ°é…ç½®é©±åŠ¨ã€‚è¿™æ˜¯æˆ‘é¡¹ç›®æ¶æ„æ¼”åŒ–ä¸­æœ€å…³é”®çš„ä¸€æ­¥ã€‚</p></blockquote><p><strong>å‰ç½®é˜…è¯»</strong>ï¼š<a href="/2025/11/01/%E4%BB%8E%E7%A1%AC%E7%BC%96%E7%A0%81%E5%88%B0%E6%8F%92%E4%BB%B6%E5%8C%96%EF%BC%88%E4%B8%8A%E7%AF%87%EF%BC%89%EF%BC%9A%E8%84%8F%E6%9E%B6%E6%9E%84%E7%9A%84%E9%97%AE%E9%A2%98%E8%AF%8A%E6%96%AD/">ä»ç¡¬ç¼–ç åˆ°æ’ä»¶åŒ–ï¼ˆä¸Šç¯‡ï¼‰ï¼šè„æ¶æ„çš„é—®é¢˜è¯Šæ–­</a>ï¼ˆå¼ºçƒˆå»ºè®®å…ˆé˜…è¯»ï¼‰</p><p><strong>æœ¬æ–‡é€‚åˆ</strong>ï¼šæ¶æ„è®¾è®¡å¸ˆã€ROS2 å¼€å‘è€…ã€ä»¥åŠæƒ³å­¦ä¹ å®é™…é¡¹ç›®æ¶æ„çš„å·¥ç¨‹å¸ˆ</p><p><strong>å†…å®¹</strong>ï¼šè®¾è®¡ç†å¿µã€è®¾è®¡å†³ç­–ã€å®Œæ•´ä»£ç å®ç°ã€ä¸ pluginlib çš„å¯¹æ¯”ã€ä¸ªäººåæ€</p><hr><h2 id="ğŸ“–-æœ¬ç¯‡å†…å®¹"><a href="#ğŸ“–-æœ¬ç¯‡å†…å®¹" class="headerlink" title="ğŸ“– æœ¬ç¯‡å†…å®¹"></a>ğŸ“– æœ¬ç¯‡å†…å®¹</h2><h3 id="ç†å¿µç¯‡ï¼šä»æ··ä¹±åˆ°æ¸…æ™°çš„è®¾è®¡æ€æƒ³"><a href="#ç†å¿µç¯‡ï¼šä»æ··ä¹±åˆ°æ¸…æ™°çš„è®¾è®¡æ€æƒ³" class="headerlink" title="ç†å¿µç¯‡ï¼šä»æ··ä¹±åˆ°æ¸…æ™°çš„è®¾è®¡æ€æƒ³"></a>ç†å¿µç¯‡ï¼šä»æ··ä¹±åˆ°æ¸…æ™°çš„è®¾è®¡æ€æƒ³</h3><ol><li><strong><a href="#%E7%AC%AC%E4%B8%80%E9%83%A8%E5%88%86-%E6%B8%85%E6%B4%81%E6%9E%B6%E6%9E%84%E7%9A%84%E6%A0%B8%E5%BF%83%E6%80%9D%E6%83%B3">æ¸…æ´æ¶æ„çš„æ ¸å¿ƒæ€æƒ³</a></strong></li><li><strong><a href="#%E7%AC%AC%E4%BA%8C%E9%83%A8%E5%88%86-%E6%B8%85%E6%B4%81%E8%AE%BE%E8%AE%A1%E7%9A%84%E5%8E%9F%E5%88%99">è®¾è®¡åŸåˆ™ä¸å…³é”®å†³ç­–</a></strong></li></ol><h3 id="å®ç°ç¯‡ï¼šä»£ç ä¸æ¶æ„çš„è½åœ°å®ç°"><a href="#å®ç°ç¯‡ï¼šä»£ç ä¸æ¶æ„çš„è½åœ°å®ç°" class="headerlink" title="å®ç°ç¯‡ï¼šä»£ç ä¸æ¶æ„çš„è½åœ°å®ç°"></a>å®ç°ç¯‡ï¼šä»£ç ä¸æ¶æ„çš„è½åœ°å®ç°</h3><ol start="3"><li><strong><a href="#%E7%AC%AC%E4%B8%89%E9%83%A8%E5%88%86-%E6%B8%85%E6%B4%81%E8%AE%BE%E8%AE%A1%E7%9A%84%E5%AE%9E%E7%8E%B0">å®Œæ•´ä»£ç å®ç°</a></strong></li><li><strong><a href="#%E7%AC%AC%E5%9B%9B%E9%83%A8%E5%88%86-%E4%B8%8E-pluginlib-%E7%9A%84%E5%AF%B9%E6%AF%94">ä¸ pluginlib çš„å¯¹æ¯”</a></strong></li><li><strong><a href="#%E7%AC%AC%E4%BA%94%E9%83%A8%E5%88%86-%E4%B8%AA%E4%BA%BA%E5%8F%8D%E6%80%9D">ä¸ªäººåæ€ä¸æ”¶ç›Š</a></strong></li></ol><hr><h2 id="ç¬¬ä¸€éƒ¨åˆ†-æ¸…æ´æ¶æ„çš„æ ¸å¿ƒæ€æƒ³"><a href="#ç¬¬ä¸€éƒ¨åˆ†-æ¸…æ´æ¶æ„çš„æ ¸å¿ƒæ€æƒ³" class="headerlink" title="ç¬¬ä¸€éƒ¨åˆ† - æ¸…æ´æ¶æ„çš„æ ¸å¿ƒæ€æƒ³"></a>ç¬¬ä¸€éƒ¨åˆ† - æ¸…æ´æ¶æ„çš„æ ¸å¿ƒæ€æƒ³</h2><h3 id="ä»â€è¿‡ç¨‹å¼æ§åˆ¶â€åˆ°â€æ¨¡å—åŒ–æ§åˆ¶â€"><a href="#ä»â€è¿‡ç¨‹å¼æ§åˆ¶â€åˆ°â€æ¨¡å—åŒ–æ§åˆ¶â€" class="headerlink" title="ä»â€è¿‡ç¨‹å¼æ§åˆ¶â€åˆ°â€æ¨¡å—åŒ–æ§åˆ¶â€"></a>ä»â€è¿‡ç¨‹å¼æ§åˆ¶â€åˆ°â€æ¨¡å—åŒ–æ§åˆ¶â€</h3><p>åœ¨æ·±å…¥å…·ä½“çš„è®¾è®¡ç»†èŠ‚å‰ï¼Œå¿…é¡»å…ˆç†è§£<strong>æ€ç»´æ–¹å¼çš„è½¬å˜</strong>ã€‚</p><h4 id="è„æ¶æ„-vs-æ¸…æ´æ¶æ„ï¼šæ€ç»´æ–¹å¼å¯¹æ¯”"><a href="#è„æ¶æ„-vs-æ¸…æ´æ¶æ„ï¼šæ€ç»´æ–¹å¼å¯¹æ¯”" class="headerlink" title="è„æ¶æ„ vs æ¸…æ´æ¶æ„ï¼šæ€ç»´æ–¹å¼å¯¹æ¯”"></a>è„æ¶æ„ vs æ¸…æ´æ¶æ„ï¼šæ€ç»´æ–¹å¼å¯¹æ¯”</h4><table><thead><tr><th>ç»´åº¦</th><th>è„æ¶æ„ï¼ˆæ—©æœŸï¼‰</th><th>æ¸…æ´æ¶æ„ï¼ˆé‡æ„ï¼‰</th><th>æ”¶ç›Š</th></tr></thead><tbody><tr><td><strong>æ§åˆ¶é€»è¾‘</strong></td><td>StateMachine ä¸»åŠ¨å‘½ä»¤å¼æ§åˆ¶</td><td>æ¯ä¸ªæ§åˆ¶å™¨è‡ªæˆ‘ç®¡ç†ç”Ÿå‘½å‘¨æœŸ</td><td>èŒè´£æ¸…æ™°</td></tr><tr><td><strong>ä»£ç ç»„ç»‡</strong></td><td>æ‰€æœ‰æ¨¡å¼æ··åœ¨ä¸€ä¸ªç±»ä¸­ï¼ˆ1000+ è¡Œï¼‰</td><td>æ¯ä¸ªæ¨¡å¼ç‹¬ç«‹æˆç±»ï¼Œå®ç°ç»Ÿä¸€æ¥å£</td><td>æ˜“ç»´æŠ¤</td></tr><tr><td><strong>æ¨¡å¼åˆ‡æ¢</strong></td><td>å·¨å¤§ switch-case + å…¨å±€çŠ¶æ€</td><td>å·¥å‚ + æ³¨å†Œæœºåˆ¶è‡ªåŠ¨åˆ‡æ¢</td><td>æ—  merge å†²çª</td></tr><tr><td><strong>é…ç½®æ–¹å¼</strong></td><td>ç¡¬ç¼–ç è¯é¢˜ã€å‚æ•°ã€æ¨¡å¼</td><td>YAML é…ç½®æ–‡ä»¶åŠ¨æ€åŠ è½½</td><td>æ— éœ€æ”¹ä»£ç </td></tr><tr><td><strong>è€¦åˆå…³ç³»</strong></td><td>æ··åœ¨ä¸€èµ·ï¼Œæ— æ³•éš”ç¦»</td><td>é€šè¿‡æ¥å£éš”ç¦»ï¼Œåˆ†å±‚æ¸…æ™°</td><td>å¯ç‹¬ç«‹æµ‹è¯•</td></tr><tr><td><strong>æ‰©å±•æ€§</strong></td><td>æ·»åŠ æ¨¡å¼ â†’ æ”¹ 6-8 å¤„ä»£ç </td><td>æ·»åŠ æ¨¡å¼ â†’ æ–°æ–‡ä»¶ + æ”¹ 1 è¡Œ</td><td>æˆæœ¬æ’å®š</td></tr><tr><td><strong>å¯æµ‹è¯•æ€§</strong></td><td>æ— æ³•å•ç‹¬æµ‹è¯•æ§åˆ¶å™¨</td><td>æ§åˆ¶å™¨å¯ç‹¬ç«‹å•å…ƒæµ‹è¯•</td><td>è´¨é‡ä¿è¯</td></tr><tr><td><strong>å¤æ‚åº¦å¢é•¿</strong></td><td>çº¿æ€§å¢é•¿ï¼ˆæ¯ä¸ªæ¨¡å¼ +150 è¡Œï¼‰</td><td>å¸¸æ•°å¢é•¿ï¼ˆæ ¸å¿ƒä»£ç ä¸å˜ï¼‰</td><td>å¯æŒç»­æ¼”åŒ–</td></tr></tbody></table><h4 id="â€œæ¸…æ´â€çš„å®šä¹‰ï¼ˆåœ¨æœ¬é¡¹ç›®è¯­å¢ƒä¸‹ï¼‰"><a href="#â€œæ¸…æ´â€çš„å®šä¹‰ï¼ˆåœ¨æœ¬é¡¹ç›®è¯­å¢ƒä¸‹ï¼‰" class="headerlink" title="â€œæ¸…æ´â€çš„å®šä¹‰ï¼ˆåœ¨æœ¬é¡¹ç›®è¯­å¢ƒä¸‹ï¼‰"></a>â€œæ¸…æ´â€çš„å®šä¹‰ï¼ˆåœ¨æœ¬é¡¹ç›®è¯­å¢ƒä¸‹ï¼‰</h4><p><strong>æ¸…æ´æ¶æ„</strong> éµå¾ªä»¥ä¸‹å››æ¡<strong>å®ç”¨æ¸…æ´åŸåˆ™</strong>ï¼š</p><ol><li><strong>ç‹¬ç«‹æ€§</strong>ï¼šæ§åˆ¶å™¨å¯ä»¥è„±ç¦»ä¸»èŠ‚ç‚¹å•ç‹¬è¿è¡Œã€å•å…ƒæµ‹è¯•</li><li><strong>é…ç½®é©±åŠ¨</strong>ï¼šä¸ä¿®æ”¹ä»£ç å³å¯æ·»åŠ æˆ–è°ƒæ•´æ§åˆ¶å™¨</li><li><strong>èŒè´£å•ä¸€</strong>ï¼šæ¯ä¸ªç±»åªåšä¸€ä»¶äº‹ï¼ˆSRP åŸåˆ™ï¼‰</li><li><strong>æ¼”åŒ–å‹å¥½</strong>ï¼šæ–°æ§åˆ¶å™¨çš„æ¥å…¥ä¸å½±å“æ—§æ§åˆ¶å™¨</li></ol><p><strong>æ¢å¥è¯è¯´</strong>ï¼šæ¸…æ´æ¶æ„çš„ç›®æ ‡ï¼Œä¸æ˜¯è¿½æ±‚â€ä¼˜é›…â€çš„ä»£ç ï¼Œè€Œæ˜¯è¿½æ±‚**â€å¯æŒç»­æ¼”åŒ–â€çš„ç³»ç»Ÿ**ã€‚</p><p>è¿™æ„å‘³ç€ï¼š</p><ul><li>æ·»åŠ ç¬¬ 10 ä¸ªæ§åˆ¶å™¨å’Œæ·»åŠ ç¬¬ 100 ä¸ªæ§åˆ¶å™¨çš„æˆæœ¬<strong>å¤§è‡´ç›¸åŒ</strong></li><li>ä¸€ä¸ªæ§åˆ¶å™¨çš„ bug ä¿®å¤<strong>ä¸ä¼šå½±å“</strong>å…¶ä»–æ§åˆ¶å™¨</li><li>æ–°æˆå‘˜åŠ å…¥å›¢é˜Ÿ<strong>ä¸éœ€è¦</strong>ç†è§£å…¨éƒ¨æ§åˆ¶é€»è¾‘</li></ul><hr><h2 id="ç¬¬äºŒéƒ¨åˆ†-æ¸…æ´è®¾è®¡çš„åŸåˆ™"><a href="#ç¬¬äºŒéƒ¨åˆ†-æ¸…æ´è®¾è®¡çš„åŸåˆ™" class="headerlink" title="ç¬¬äºŒéƒ¨åˆ† - æ¸…æ´è®¾è®¡çš„åŸåˆ™"></a>ç¬¬äºŒéƒ¨åˆ† - æ¸…æ´è®¾è®¡çš„åŸåˆ™</h2><h3 id="2-0-è„æ¶æ„çš„ä»£ä»·å¯¹æ¯”"><a href="#2-0-è„æ¶æ„çš„ä»£ä»·å¯¹æ¯”" class="headerlink" title="2.0 è„æ¶æ„çš„ä»£ä»·å¯¹æ¯”"></a>2.0 è„æ¶æ„çš„ä»£ä»·å¯¹æ¯”</h3><p>æ·»åŠ æ–°æ§åˆ¶å™¨æ—¶çš„ä¿®æ”¹æˆæœ¬å¯¹æ¯”ï¼š</p><table><thead><tr><th>æŒ‡æ ‡</th><th>è„æ¶æ„</th><th>æ¸…æ´æ¶æ„</th></tr></thead><tbody><tr><td><strong>ä¿®æ”¹æ–‡ä»¶æ•°</strong></td><td>6-8 ä¸ª</td><td>3 ä¸ª</td></tr><tr><td><strong>ä¿®æ”¹æ ¸å¿ƒä»£ç å¤„æ•°</strong></td><td>6-8 å¤„</td><td>1 å¤„</td></tr><tr><td><strong>æ–°å¢æ€»ä»£ç è¡Œæ•°</strong></td><td>200-300 è¡Œ</td><td>150-250 è¡Œ</td></tr><tr><td><strong>æ–°å¢æ ¸å¿ƒä»£ç è¡Œæ•°</strong></td><td>~100 è¡Œ</td><td>&lt; 10 è¡Œ</td></tr><tr><td><strong>åˆ›å»ºæ–°æ–‡ä»¶</strong></td><td>æ— </td><td>1 ä¸ªï¼ˆcontroller ç±»ï¼‰</td></tr><tr><td><strong>å¼€å‘å‘¨æœŸ</strong></td><td>1-3 å¤©</td><td>2-4 å°æ—¶</td></tr><tr><td><strong>merge å†²çªé£é™©</strong></td><td>é«˜ï¼ˆå¤šäººæ”¹åŒä¸€å¤„ï¼‰</td><td>ä½ï¼ˆå‡ ä¹æ— å†²çªï¼‰</td></tr><tr><td><strong>å›å½’æµ‹è¯•èŒƒå›´</strong></td><td>æ•´ä¸ª StateMachine</td><td>ä»…æ–°æ§åˆ¶å™¨</td></tr></tbody></table><p><strong>å…·ä½“ä¿®æ”¹æ¸…å•å¯¹æ¯”</strong>ï¼š</p><p>è„æ¶æ„éœ€è¦æ”¹ï¼š</p><ol><li>robot_state_machine.hpp - æ·»åŠ  5-10 ä¸ªæˆå‘˜å˜é‡</li><li>robot_state_machine.cpp æ„é€ å‡½æ•° - æ·»åŠ è®¢é˜…</li><li>working_mode_callback() - æ·»åŠ  case</li><li>æ–°å¢ 5 ä¸ªæ–°çš„å›è°ƒ&#x2F;çº¿ç¨‹å‡½æ•°</li></ol><p>æ¸…æ´æ¶æ„åªéœ€ï¼š</p><ol><li>åˆ›å»º my_new_controller.hpp&#x2F;cpp</li><li>controller_registry.cpp æ·»åŠ  1 è¡Œ</li><li>config.yaml æ·»åŠ  4 è¡Œé…ç½®</li></ol><h3 id="2-1-æ ¸å¿ƒè®¾è®¡ç›®æ ‡"><a href="#2-1-æ ¸å¿ƒè®¾è®¡ç›®æ ‡" class="headerlink" title="2.1 æ ¸å¿ƒè®¾è®¡ç›®æ ‡"></a>2.1 æ ¸å¿ƒè®¾è®¡ç›®æ ‡</h3><p>æˆ‘ä»¬å¸Œæœ›å®ç°ä¸€ä¸ªç³»ç»Ÿï¼Œæ»¡è¶³ï¼š</p><ol><li><strong>é…ç½®é©±åŠ¨</strong>ï¼šåœ¨ YAML ä¸­å£°æ˜æ§åˆ¶å™¨ï¼Œä»£ç è‡ªåŠ¨åŠ è½½</li><li><strong>æ¾è€¦åˆ</strong>ï¼šæ·»åŠ æ–°æ§åˆ¶å™¨ä¸éœ€è¦ä¿®æ”¹æ ¸å¿ƒä»£ç </li><li><strong>å•ä¸€èŒè´£</strong>ï¼šæ¯ä¸ªæ§åˆ¶å™¨åªç®¡ç†è‡ªå·±</li><li><strong>ç±»å‹å®‰å…¨</strong>ï¼šç¼–è¯‘æœŸæ£€æŸ¥ï¼Œé¿å…è¿è¡ŒæœŸé”™è¯¯</li><li><strong>æ˜“äºæ‰©å±•</strong>ï¼šæ–°æ§åˆ¶å™¨å¼€å‘è€…åªéœ€å®ç°æ¥å£</li></ol><h3 id="2-2-å…³é”®è®¾è®¡å†³ç­–"><a href="#2-2-å…³é”®è®¾è®¡å†³ç­–" class="headerlink" title="2.2 å…³é”®è®¾è®¡å†³ç­–"></a>2.2 å…³é”®è®¾è®¡å†³ç­–</h3><h4 id="å†³ç­–-1ï¼šä½¿ç”¨å·¥å‚-Lambda-ä»£æ›¿è™šå‡½æ•°"><a href="#å†³ç­–-1ï¼šä½¿ç”¨å·¥å‚-Lambda-ä»£æ›¿è™šå‡½æ•°" class="headerlink" title="å†³ç­– 1ï¼šä½¿ç”¨å·¥å‚ Lambda ä»£æ›¿è™šå‡½æ•°"></a><strong>å†³ç­– 1ï¼šä½¿ç”¨å·¥å‚ Lambda ä»£æ›¿è™šå‡½æ•°</strong></h4><p><strong>åé¢æ•™æï¼šSwitch-case çš„é—®é¢˜</strong></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// âŒ æ—§æ–¹å¼ï¼šå·¨å¤§çš„ switch-case</span></span><br><span class="line"><span class="function">std::shared_ptr&lt;ModeControllerBase&gt; <span class="title">create_controller</span><span class="params">(<span class="type">const</span> std::string&amp; class_name, rclcpp::Node::SharedPtr node)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">switch</span>(<span class="built_in">hash</span>(class_name)) &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&quot;MoveJController&quot;</span>_hash:</span><br><span class="line">            <span class="keyword">return</span> std::<span class="built_in">make_shared</span>&lt;MoveJController&gt;(node);</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&quot;MoveLController&quot;</span>_hash:</span><br><span class="line">            <span class="keyword">return</span> std::<span class="built_in">make_shared</span>&lt;MoveLController&gt;(node);</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&quot;CartesianVelocityController&quot;</span>_hash:</span><br><span class="line">            <span class="keyword">return</span> std::<span class="built_in">make_shared</span>&lt;CartesianVelocityController&gt;(node);</span><br><span class="line">        <span class="comment">// ... æ¯æ·»åŠ ä¸€ä¸ªæ–°æ§åˆ¶å™¨ï¼Œè¿™ä¸ªå‡½æ•°å°±è¦ä¿®æ”¹ï¼</span></span><br><span class="line">        <span class="keyword">default</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">nullptr</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™æ ·çš„é—®é¢˜æ˜¯ï¼š</p><ul><li>æ¯ä¸ªæ–°æ§åˆ¶å™¨éƒ½è¦ä¿®æ”¹è¿™ä¸ªåˆ›å»ºå‡½æ•°</li><li>switch-case ä¸æ–­å¢é•¿</li><li>å®¹æ˜“å‡ºç° merge å†²çª</li></ul><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// âœ“ æ¨èï¼šå·¥å‚ Lambda</span></span><br><span class="line"><span class="function">std::unordered_map&lt;std::string, ControllerInterface::Creator&gt; <span class="title">get_available_controllers</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        &#123;<span class="string">&quot;MoveJController&quot;</span>, [](rclcpp::Node::SharedPtr node) &#123;</span><br><span class="line">            <span class="keyword">return</span> std::<span class="built_in">make_shared</span>&lt;MoveJController&gt;(node); &#125;&#125;,</span><br><span class="line">        &#123;<span class="string">&quot;MoveLController&quot;</span>, [](rclcpp::Node::SharedPtr node) &#123;</span><br><span class="line">            <span class="keyword">return</span> std::<span class="built_in">make_shared</span>&lt;MoveLController&gt;(node); &#125;&#125;,</span><br><span class="line">        &#123;<span class="string">&quot;CartesianVelocityController&quot;</span>, [](rclcpp::Node::SharedPtr node) &#123;</span><br><span class="line">            <span class="keyword">return</span> std::<span class="built_in">make_shared</span>&lt;CartesianVelocityController&gt;(node); &#125;&#125;,</span><br><span class="line">        <span class="comment">// ... æ¯æ·»åŠ ä¸€ä¸ªæ§åˆ¶å™¨ï¼Œåªéœ€æ·»åŠ  1 è¡Œï¼æ— éœ€ä¿®æ”¹åˆ›å»ºé€»è¾‘</span></span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä½¿ç”¨æ—¶ï¼š</span></span><br><span class="line"><span class="keyword">auto</span> it = available.<span class="built_in">find</span>(class_name);</span><br><span class="line"><span class="keyword">if</span> (it != available.<span class="built_in">end</span>()) &#123;</span><br><span class="line">    <span class="keyword">auto</span> controller = it-&gt;<span class="built_in">second</span>(node);  <span class="comment">// è°ƒç”¨å¯¹åº”çš„å·¥å‚ Lambda</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>å¯¹æ¯”</strong>ï¼š</p><ul><li>æ—§æ–¹å¼ï¼šæ–°å¢æ§åˆ¶å™¨ â†’ ä¿®æ”¹åˆ›å»ºå‡½æ•° â†’ é‡æ–°ç¼–è¯‘æ•´ä¸ªé¡¹ç›®</li><li>æ–°æ–¹å¼ï¼šæ–°å¢æ§åˆ¶å™¨ â†’ åœ¨ map ä¸­æ·»åŠ ä¸€è¡Œ â†’ ä»£ç æ›´æ–°å³å¯</li></ul><h4 id="å†³ç­–-2ï¼šä½¿ç”¨å­—ç¬¦ä¸²-Key-è€Œéæšä¸¾"><a href="#å†³ç­–-2ï¼šä½¿ç”¨å­—ç¬¦ä¸²-Key-è€Œéæšä¸¾" class="headerlink" title="å†³ç­– 2ï¼šä½¿ç”¨å­—ç¬¦ä¸² Key è€Œéæšä¸¾"></a><strong>å†³ç­– 2ï¼šä½¿ç”¨å­—ç¬¦ä¸² Key è€Œéæšä¸¾</strong></h4><p><strong>åé¢æ•™æï¼šEnum çš„ç»´æŠ¤è´Ÿæ‹…</strong></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// âŒ æ—§æ–¹å¼ï¼šæšä¸¾ + å­—ç¬¦ä¸²æ˜ å°„</span></span><br><span class="line"><span class="keyword">enum class</span> <span class="title class_">ControlMode</span> &#123;</span><br><span class="line">    CARTESIAN_VELOCITY = <span class="number">1</span>,</span><br><span class="line">    JOINT_VELOCITY = <span class="number">2</span>,</span><br><span class="line">    MOVE_J = <span class="number">3</span>,</span><br><span class="line">    MOVE_L = <span class="number">4</span>,</span><br><span class="line">    <span class="comment">// ... æ¯æ·»åŠ ä¸€ä¸ªæ¨¡å¼ï¼Œéœ€è¦æ·»åŠ æ–°çš„æšä¸¾å€¼</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è¿˜éœ€è¦ç»´æŠ¤ä¸€ä¸ªæ˜ å°„è¡¨</span></span><br><span class="line">std::map&lt;ControlMode, std::string&gt; mode_to_string = &#123;</span><br><span class="line">    &#123;ControlMode::CARTESIAN_VELOCITY, <span class="string">&quot;CartesianVelocity&quot;</span>&#125;,</span><br><span class="line">    &#123;ControlMode::JOINT_VELOCITY, <span class="string">&quot;JointVelocity&quot;</span>&#125;,</span><br><span class="line">    <span class="comment">// ... ä¸¤å¤„éƒ½è¦ä¿®æ”¹ï¼</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// YAML ä¸­</span></span><br><span class="line">mode: <span class="number">1</span>  <span class="comment">// ç”¨æšä¸¾å€¼ï¼Œä¸ç›´è§‚</span></span><br></pre></td></tr></table></figure><p>è¿™æ ·çš„é—®é¢˜ï¼š</p><ul><li>ä¿®æ”¹ä¸€ä¸ªåœ°æ–¹è¦åŒæ—¶æ”¹ enum å’Œ mapping è¡¨</li><li>å®¹æ˜“é—æ¼æˆ–ä¸åŒæ­¥</li><li>YAML ä¸­ç”¨æ•°å­—ä¸ç›´è§‚</li></ul><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// âœ“ æ¨èï¼šå­—ç¬¦ä¸² Key</span></span><br><span class="line">controller_map_[<span class="string">&quot;CartesianVelocity&quot;</span>] = controller_instance;</span><br><span class="line"></span><br><span class="line"><span class="comment">// YAML ä¸­ï¼ˆå®Œå…¨ä¸€è‡´ï¼Œä¸€ç›®äº†ç„¶ï¼‰</span></span><br><span class="line">controllers:</span><br><span class="line">  - key: CartesianVelocity</span><br><span class="line">    <span class="keyword">class</span>: CartesianVelocityController</span><br></pre></td></tr></table></figure><p><strong>ä¼˜åŠ¿</strong>ï¼š</p><ul><li>YAML å’Œä»£ç ä¸­çš„ key å®Œå…¨ä¸€è‡´ï¼Œæ— éœ€è½¬æ¢</li><li>æ·»åŠ æ–°æ¨¡å¼æ—¶åªéœ€åœ¨ä¸€å¤„ä¿®æ”¹</li><li>è‡ªæè¿°ï¼Œéå¸¸ç›´è§‚</li></ul><h4 id="å†³ç­–-3ï¼šä½¿ç”¨-std-any-åšæ¶ˆæ¯å®¹å™¨"><a href="#å†³ç­–-3ï¼šä½¿ç”¨-std-any-åšæ¶ˆæ¯å®¹å™¨" class="headerlink" title="å†³ç­– 3ï¼šä½¿ç”¨ std::any åšæ¶ˆæ¯å®¹å™¨"></a><strong>å†³ç­– 3ï¼šä½¿ç”¨ std::any åšæ¶ˆæ¯å®¹å™¨</strong></h4><p><strong>é—®é¢˜ï¼šå¦‚ä½•åœ¨å¤šæ€çš„åŒæ—¶ä¿æŒç±»å‹å®‰å…¨ï¼Ÿ</strong></p><p>ä¸€ä¸ªå¸¸è§çš„é”™è¯¯åšæ³•æ˜¯ä½¿ç”¨ <code>void*</code> çš„è½¬å‹ï¼Œè¿™å¾ˆå±é™©ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// âŒ å±é™©çš„ void* è½¬å‹</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ModeControllerBase</span> &#123;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">handle_message</span><span class="params">(<span class="type">void</span>* msg)</span> </span>= <span class="number">0</span>;  <span class="comment">// ç±»å‹ä¿¡æ¯ä¸¢å¤±ï¼</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">CartesianVelocityController</span> : <span class="keyword">public</span> ModeControllerBase &#123;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">handle_message</span><span class="params">(<span class="type">void</span>* msg)</span> <span class="keyword">override</span> </span>&#123;</span><br><span class="line">        <span class="comment">// è¿™é‡Œéœ€è¦çŒœæµ‹ msg æ˜¯ä»€ä¹ˆç±»å‹ï¼Œå®¹æ˜“å‡ºé”™</span></span><br><span class="line">        <span class="keyword">auto</span> twist = <span class="built_in">static_cast</span>&lt;geometry_msgs::msg::TwistStamped*&gt;(msg);</span><br><span class="line">        <span class="comment">// å¦‚æœ msg å®é™…ä¸Šæ˜¯å…¶ä»–ç±»å‹ï¼Œè¿è¡Œæ—¶ä¼šå´©æºƒ</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼šstd::any + æ¨¡æ¿çš„ç»„åˆ</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// âœ“ ç±»å‹å®‰å…¨çš„è§£å†³æ–¹æ¡ˆ</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ModeControllerBase</span> &#123;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">handle_message</span><span class="params">(std::any msg)</span> </span>= <span class="number">0</span>;  <span class="comment">// ä¿ç•™ç±»å‹ä¿¡æ¯</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">VelocityControllerImpl</span> : <span class="keyword">public</span> ModeControllerBase &#123;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">handle_message</span><span class="params">(std::any msg)</span> <span class="keyword">override</span> <span class="keyword">final</span> </span>&#123;</span><br><span class="line">        <span class="keyword">auto</span> typed_msg = std::<span class="built_in">any_cast</span>&lt;<span class="keyword">typename</span> T::SharedPtr&gt;(msg);  <span class="comment">// ç¼–è¯‘æœŸç±»å‹æ£€æŸ¥</span></span><br><span class="line">        <span class="built_in">velocity_callback</span>(typed_msg);  <span class="comment">// æ´¾ç”Ÿç±»æ— éœ€å…³å¿ƒè½¬æ¢</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><strong>ä¼˜åŠ¿</strong>ï¼š</p><ul><li>ç¼–è¯‘æœŸç±»å‹æ£€æŸ¥ï¼šç±»å‹ä¸åŒ¹é…ä¼šåœ¨ç¼–è¯‘æ—¶å¤±è´¥</li><li>æ´¾ç”Ÿç±»å®ç°è€…ä¸ç”¨å…³å¿ƒè½¬æ¢ç»†èŠ‚</li><li>å¤šæ€å’Œç±»å‹å®‰å…¨çš„å®Œç¾ç»“åˆ</li></ul><hr><h2 id="ç¬¬ä¸‰éƒ¨åˆ†-æ¸…æ´è®¾è®¡çš„å®ç°"><a href="#ç¬¬ä¸‰éƒ¨åˆ†-æ¸…æ´è®¾è®¡çš„å®ç°" class="headerlink" title="ç¬¬ä¸‰éƒ¨åˆ† - æ¸…æ´è®¾è®¡çš„å®ç°"></a>ç¬¬ä¸‰éƒ¨åˆ† - æ¸…æ´è®¾è®¡çš„å®ç°</h2><h3 id="3-1-æ ¸å¿ƒç»„ä»¶"><a href="#3-1-æ ¸å¿ƒç»„ä»¶" class="headerlink" title="3.1 æ ¸å¿ƒç»„ä»¶"></a>3.1 æ ¸å¿ƒç»„ä»¶</h3><h4 id="ControllerInterfaceï¼ˆä¸­å¤®æ³¨å†Œè¡¨ï¼‰"><a href="#ControllerInterfaceï¼ˆä¸­å¤®æ³¨å†Œè¡¨ï¼‰" class="headerlink" title="ControllerInterfaceï¼ˆä¸­å¤®æ³¨å†Œè¡¨ï¼‰"></a><strong>ControllerInterfaceï¼ˆä¸­å¤®æ³¨å†Œè¡¨ï¼‰</strong></h4><p><strong>ä¸ºä»€ä¹ˆç”¨å•ä¾‹ï¼Ÿ</strong></p><p>ControllerInterface æ˜¯ç³»ç»Ÿçš„â€é»„é¡µâ€â€”â€”å…¨å±€å”¯ä¸€çš„æ§åˆ¶å™¨åç§°åˆ°åˆ›å»ºæ–¹æ³•çš„æ˜ å°„ã€‚å®ƒéœ€è¦ï¼š</p><ul><li><strong>å…¨å±€å”¯ä¸€</strong>ï¼šç³»ç»Ÿåªæœ‰ä¸€ä»½æ³¨å†Œè¡¨</li><li><strong>å¯åŠ¨æ—¶åˆå§‹åŒ–</strong>ï¼šåœ¨åº”ç”¨å¯åŠ¨æ—¶é›†ä¸­å¡«å……</li><li><strong>çº¿ç¨‹å®‰å…¨</strong>ï¼šå¤šä¸ªåœ°æ–¹éƒ½å¯èƒ½æŸ¥è¯¢</li><li><strong>ä¸ä¸šåŠ¡é€»è¾‘éš”ç¦»</strong>ï¼šä¸æ¶‰åŠå…·ä½“çš„ä¸šåŠ¡çŠ¶æ€</li></ul><p>å› æ­¤å•ä¾‹æ¨¡å¼æ˜¯åˆé€‚çš„é€‰æ‹©ã€‚å®ƒä¸æ˜¯â€ä¸šåŠ¡é€»è¾‘çš„å•ä¾‹â€ï¼ˆé‚£æ˜¯åæ¨¡å¼ï¼‰ï¼Œè€Œæ˜¯â€åŸºç¡€è®¾æ–½çš„å•ä¾‹â€ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">ControllerInterface</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="keyword">using</span> Creator = std::function&lt;std::<span class="built_in">shared_ptr</span>&lt;ModeControllerBase&gt;(rclcpp::Node::SharedPtr)&gt;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å•ä¾‹è·å–æ¥å£</span></span><br><span class="line">    <span class="function"><span class="type">static</span> ControllerInterface&amp; <span class="title">instance</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="type">static</span> ControllerInterface instance;</span><br><span class="line">        <span class="keyword">return</span> instance;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ³¨å†Œæ§åˆ¶å™¨ç±»</span></span><br><span class="line">    <span class="function"><span class="type">bool</span> <span class="title">register_class</span><span class="params">(<span class="type">const</span> std::string&amp; name, Creator creator)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> registry_.<span class="built_in">emplace</span>(name, creator).second;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åˆ›å»ºæ§åˆ¶å™¨å®ä¾‹</span></span><br><span class="line">    <span class="function">std::shared_ptr&lt;ModeControllerBase&gt; <span class="title">create</span><span class="params">(<span class="type">const</span> std::string&amp; name, rclcpp::Node::SharedPtr node)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">auto</span> it = registry_.<span class="built_in">find</span>(name);</span><br><span class="line">        <span class="keyword">if</span> (it != registry_.<span class="built_in">end</span>()) &#123;</span><br><span class="line">            <span class="keyword">return</span> it-&gt;<span class="built_in">second</span>(node);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nullptr</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="built_in">ControllerInterface</span>() = <span class="keyword">default</span>;</span><br><span class="line">    std::unordered_map&lt;std::string, Creator&gt; registry_;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><strong>å…³é”®ç‚¹</strong>ï¼š</p><ul><li>å•ä¾‹æ¨¡å¼ï¼šå…¨å±€å”¯ä¸€çš„æ³¨å†Œè¡¨</li><li>æŸ¥è¯¢ O(1) æ—¶é—´å¤æ‚åº¦</li></ul><h4 id="åŸºç±»è®¾è®¡"><a href="#åŸºç±»è®¾è®¡" class="headerlink" title="åŸºç±»è®¾è®¡"></a><strong>åŸºç±»è®¾è®¡</strong></h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">ModeControllerBase</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">start</span><span class="params">(<span class="type">const</span> std::string&amp; mapping = <span class="string">&quot;&quot;</span>)</span> </span>&#123; is_active_ = <span class="literal">true</span>; &#125;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">bool</span> <span class="title">stop</span><span class="params">(<span class="type">const</span> std::string&amp; mapping = <span class="string">&quot;&quot;</span>)</span> </span>&#123; is_active_ = <span class="literal">false</span>; <span class="keyword">return</span> <span class="literal">true</span>; &#125;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">handle_message</span><span class="params">(std::any msg)</span> </span>= <span class="number">0</span>;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">bool</span> <span class="title">needs_hook_state</span><span class="params">()</span> <span class="type">const</span> </span>&#123; <span class="keyword">return</span> <span class="literal">false</span>; &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">protected</span>:</span><br><span class="line">    <span class="type">bool</span> is_active_ = <span class="literal">false</span>;</span><br><span class="line">    std::string mode_;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h4 id="å·¥å‚æ–¹æ³•æ³¨å†Œ"><a href="#å·¥å‚æ–¹æ³•æ³¨å†Œ" class="headerlink" title="å·¥å‚æ–¹æ³•æ³¨å†Œ"></a><strong>å·¥å‚æ–¹æ³•æ³¨å†Œ</strong></h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// controller/controller_registry.cpp</span></span><br><span class="line"><span class="function">std::unordered_map&lt;std::string, ControllerInterface::Creator&gt; <span class="title">get_available_controllers</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        &#123;<span class="string">&quot;CartesianVelocityController&quot;</span>, [](rclcpp::Node::SharedPtr node) &#123;</span><br><span class="line">            <span class="keyword">return</span> std::<span class="built_in">make_shared</span>&lt;CartesianVelocityController&gt;(node);</span><br><span class="line">        &#125;&#125;,</span><br><span class="line">        &#123;<span class="string">&quot;JointVelocityController&quot;</span>, [](rclcpp::Node::SharedPtr node) &#123;</span><br><span class="line">            <span class="keyword">return</span> std::<span class="built_in">make_shared</span>&lt;JointVelocityController&gt;(node);</span><br><span class="line">        &#125;&#125;,</span><br><span class="line">        &#123;<span class="string">&quot;MoveJController&quot;</span>, [](rclcpp::Node::SharedPtr node) &#123;</span><br><span class="line">            <span class="keyword">return</span> std::<span class="built_in">make_shared</span>&lt;MoveJController&gt;(node);</span><br><span class="line">        &#125;&#125;,</span><br><span class="line">        <span class="comment">// ... æ›´å¤šæ§åˆ¶å™¨ ...</span></span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="é…ç½®æ–‡ä»¶ï¼ˆconfig-yamlï¼‰"><a href="#é…ç½®æ–‡ä»¶ï¼ˆconfig-yamlï¼‰" class="headerlink" title="é…ç½®æ–‡ä»¶ï¼ˆconfig.yamlï¼‰"></a><strong>é…ç½®æ–‡ä»¶ï¼ˆconfig.yamlï¼‰</strong></h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">controllers:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">key:</span> <span class="string">CartesianVelocity</span></span><br><span class="line">    <span class="attr">class:</span> <span class="string">CartesianVelocityController</span></span><br><span class="line">    <span class="attr">input_topic:</span></span><br><span class="line">      <span class="attr">name:</span> <span class="string">/controller_api/cartesian_velocity_action</span></span><br><span class="line"></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">key:</span> <span class="string">JointVelocity</span></span><br><span class="line">    <span class="attr">class:</span> <span class="string">JointVelocityController</span></span><br><span class="line">    <span class="attr">input_topic:</span></span><br><span class="line">      <span class="attr">name:</span> <span class="string">/controller_api/joint_velocity_action</span></span><br><span class="line"></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">key:</span> <span class="string">MoveJ</span></span><br><span class="line">    <span class="attr">class:</span> <span class="string">MoveJController</span></span><br><span class="line">    <span class="attr">input_topic:</span></span><br><span class="line">      <span class="attr">name:</span> <span class="string">/controller_api/movej_action</span></span><br></pre></td></tr></table></figure><h3 id="3-2-åˆå§‹åŒ–æµç¨‹"><a href="#3-2-åˆå§‹åŒ–æµç¨‹" class="headerlink" title="3.2 åˆå§‹åŒ–æµç¨‹"></a>3.2 åˆå§‹åŒ–æµç¨‹</h3><h4 id="æ­¥éª¤-1ï¼šåŠ è½½é…ç½®"><a href="#æ­¥éª¤-1ï¼šåŠ è½½é…ç½®" class="headerlink" title="æ­¥éª¤ 1ï¼šåŠ è½½é…ç½®"></a><strong>æ­¥éª¤ 1ï¼šåŠ è½½é…ç½®</strong></h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">ControllerManagerNode::load_config</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        std::string yaml_path = pkg_path + <span class="string">&quot;/config/config.yaml&quot;</span>;</span><br><span class="line">        yaml_config_ = YAML::<span class="built_in">LoadFile</span>(yaml_path);</span><br><span class="line">        <span class="built_in">RCLCPP_INFO</span>(<span class="built_in">get_logger</span>(), <span class="string">&quot;Configuration loaded successfully&quot;</span>);</span><br><span class="line">    &#125; <span class="built_in">catch</span> (<span class="type">const</span> std::exception&amp; e) &#123;</span><br><span class="line">        <span class="built_in">RCLCPP_FATAL</span>(<span class="built_in">get_logger</span>(), <span class="string">&quot;Failed to load configuration: %s&quot;</span>, e.<span class="built_in">what</span>());</span><br><span class="line">        rclcpp::<span class="built_in">shutdown</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="æ­¥éª¤-2-3ï¼šåˆå§‹åŒ–æ§åˆ¶å™¨"><a href="#æ­¥éª¤-2-3ï¼šåˆå§‹åŒ–æ§åˆ¶å™¨" class="headerlink" title="æ­¥éª¤ 2-3ï¼šåˆå§‹åŒ–æ§åˆ¶å™¨"></a><strong>æ­¥éª¤ 2-3ï¼šåˆå§‹åŒ–æ§åˆ¶å™¨</strong></h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">ControllerManagerNode::init_controllers</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">auto</span> available = <span class="built_in">get_available_controllers</span>();  <span class="comment">// è·å–å·¥å‚æ–¹æ³•</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">const</span> <span class="keyword">auto</span>&amp; entry : yaml_config_[<span class="string">&quot;controllers&quot;</span>]) &#123;</span><br><span class="line">            std::string key = entry[<span class="string">&quot;key&quot;</span>].<span class="built_in">as</span>&lt;std::string&gt;();</span><br><span class="line">            std::string class_name = entry[<span class="string">&quot;class&quot;</span>].<span class="built_in">as</span>&lt;std::string&gt;();</span><br><span class="line"></span><br><span class="line">            <span class="keyword">auto</span> it = available.<span class="built_in">find</span>(class_name);</span><br><span class="line">            <span class="keyword">if</span> (it != available.<span class="built_in">end</span>()) &#123;</span><br><span class="line">                <span class="comment">// ä½¿ç”¨å·¥å‚æ–¹æ³•åˆ›å»ºå®ä¾‹</span></span><br><span class="line">                <span class="keyword">auto</span> controller = it-&gt;<span class="built_in">second</span>(<span class="keyword">this</span>-&gt;<span class="built_in">shared_from_this</span>());</span><br><span class="line"></span><br><span class="line">                <span class="comment">// æ³¨å†Œåˆ°ä¸­å¤®æ³¨å†Œè¡¨</span></span><br><span class="line">                ControllerInterface::<span class="built_in">instance</span>().<span class="built_in">register_class</span>(key, it-&gt;second);</span><br><span class="line"></span><br><span class="line">                <span class="comment">// ä¿å­˜åˆ°æœ¬åœ° map</span></span><br><span class="line">                controller_map_[key] = controller;</span><br><span class="line"></span><br><span class="line">                <span class="built_in">RCLCPP_INFO</span>(<span class="built_in">get_logger</span>(), <span class="string">&quot;Registered controller: %s&quot;</span>, key.<span class="built_in">c_str</span>());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="built_in">catch</span> (<span class="type">const</span> std::exception&amp; e) &#123;</span><br><span class="line">        <span class="built_in">RCLCPP_FATAL</span>(<span class="built_in">get_logger</span>(), <span class="string">&quot;Failed to initialize: %s&quot;</span>, e.<span class="built_in">what</span>());</span><br><span class="line">        rclcpp::<span class="built_in">shutdown</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3-3-æ·»åŠ æ–°æ§åˆ¶å™¨çš„å®Œæ•´æ­¥éª¤"><a href="#3-3-æ·»åŠ æ–°æ§åˆ¶å™¨çš„å®Œæ•´æ­¥éª¤" class="headerlink" title="3.3 æ·»åŠ æ–°æ§åˆ¶å™¨çš„å®Œæ•´æ­¥éª¤"></a>3.3 æ·»åŠ æ–°æ§åˆ¶å™¨çš„å®Œæ•´æ­¥éª¤</h3><p>ç°åœ¨ï¼Œæ·»åŠ æ–°æ§åˆ¶å™¨å˜å¾—ç®€å•ï¼š</p><p><strong>æ­¥éª¤ 1</strong>ï¼šåˆ›å»ºæ–°æ§åˆ¶å™¨ç±»</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MyNewController</span> : <span class="keyword">public</span> VelocityControllerImpl&lt;MyMessageType&gt; &#123;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">velocity_callback</span><span class="params">(<span class="type">const</span> MyMessageType::SharedPtr msg)</span> <span class="keyword">override</span> </span>&#123;</span><br><span class="line">        <span class="comment">// ä¸šåŠ¡é€»è¾‘</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><strong>æ­¥éª¤ 2</strong>ï¼šåœ¨ <code>get_available_controllers()</code> ä¸­æ·»åŠ ä¸€è¡Œ</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="string">&quot;MyNewController&quot;</span>, [](rclcpp::Node::SharedPtr node) &#123;</span><br><span class="line">    <span class="keyword">return</span> std::<span class="built_in">make_shared</span>&lt;MyNewController&gt;(node);</span><br><span class="line">&#125;&#125;,</span><br></pre></td></tr></table></figure><p><strong>æ­¥éª¤ 3</strong>ï¼šåœ¨ YAML ä¸­æ·»åŠ é…ç½®</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="bullet">-</span> <span class="attr">key:</span> <span class="string">MyNewMode</span></span><br><span class="line">  <span class="attr">class:</span> <span class="string">MyNewController</span></span><br><span class="line">  <span class="attr">input_topic:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">/controller_api/my_new_mode_action</span></span><br></pre></td></tr></table></figure><p><strong>å®Œæˆï¼</strong> ç³»ç»Ÿè‡ªåŠ¨åŠ è½½æ–°æ§åˆ¶å™¨ã€‚</p><h3 id="ç³»ç»Ÿæ¶æ„æ€»è§ˆ"><a href="#ç³»ç»Ÿæ¶æ„æ€»è§ˆ" class="headerlink" title="ç³»ç»Ÿæ¶æ„æ€»è§ˆ"></a>ç³»ç»Ÿæ¶æ„æ€»è§ˆ</h3><p>ç»è¿‡ä»¥ä¸Šä¸‰æ­¥ï¼Œæ–°æ§åˆ¶å™¨å·²è¢«æ•´åˆåˆ°æ¸…æ´æ¶æ„ä¸­ã€‚å®è§‚æ¥çœ‹ï¼Œç³»ç»Ÿçš„ç»„ç»‡ç»“æ„æ˜¯è¿™æ ·çš„ï¼š</p><p><strong>ç¬¬ä¸€å±‚ï¼šControllerManagerï¼ˆä¸»ç®¡ç†å™¨ï¼‰</strong></p><ul><li>èŒè´£ï¼šåˆå§‹åŒ–ã€ç”Ÿå‘½å‘¨æœŸç®¡ç†ã€æ¨¡å¼åˆ‡æ¢</li><li>å…³é”®æ–¹æ³•ï¼š<code>load_config()</code> â†’ <code>init_controllers()</code> â†’ <code>handle_work_mode()</code></li><li>ç‰¹ç‚¹ï¼šä»£ç è¡Œæ•°ä¿æŒç¨³å®šï¼Œä¸æ§åˆ¶å™¨æ•°é‡æ— å…³</li></ul><p><strong>ç¬¬äºŒå±‚ï¼šControllerInterfaceï¼ˆä¸­å¤®æ³¨å†Œè¡¨ï¼‰</strong></p><ul><li>èŒè´£ï¼šç»´æŠ¤å…¨å±€çš„æ§åˆ¶å™¨æ˜ å°„ï¼ˆkey â†’ factory methodï¼‰</li><li>å®ç°æ–¹å¼ï¼šå•ä¾‹æ¨¡å¼</li><li>ç‰¹ç‚¹ï¼šå¯åŠ¨æ—¶é›†ä¸­åˆå§‹åŒ–ï¼Œè¿è¡Œæ—¶ O(1) æŸ¥è¯¢</li></ul><p><strong>ç¬¬ä¸‰å±‚ï¼šå„ä¸ªå…·ä½“æ§åˆ¶å™¨</strong></p><ul><li>CartesianVelocityControllerï¼ˆç¬›å¡å°”é€Ÿåº¦æ§åˆ¶ï¼‰</li><li>JointVelocityControllerï¼ˆå…³èŠ‚é€Ÿåº¦æ§åˆ¶ï¼‰</li><li>MoveJControllerï¼ˆå…³èŠ‚æ’å€¼è¿åŠ¨ï¼‰</li><li>â€¦ æ›´å¤šæ§åˆ¶å™¨</li></ul><p><strong>æ‰©å±•æµç¨‹</strong>ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">æ–°å¢æ§åˆ¶å™¨ç±» (MyNewController.hpp/.cpp)</span><br><span class="line">           â†“</span><br><span class="line">åœ¨ registry.cpp æ·»åŠ ä¸€è¡Œå·¥å‚æ–¹æ³•</span><br><span class="line">           â†“</span><br><span class="line">åœ¨ config.yaml æ·»åŠ æ§åˆ¶å™¨é…ç½®</span><br><span class="line">           â†“</span><br><span class="line">ç³»ç»Ÿå¯åŠ¨æ—¶è‡ªåŠ¨åŠ è½½ï¼Œæ— éœ€ä¿®æ”¹æ ¸å¿ƒä»£ç </span><br></pre></td></tr></table></figure><p><strong>è¿™ä¸ªç»“æ„çš„æ ¸å¿ƒä¼˜åŠ¿</strong>ï¼š</p><ul><li>âœ… ControllerManager çš„ä»£ç é‡ä¸å¢é•¿ï¼ˆæ–°å¢æ§åˆ¶å™¨å¯¹å®ƒé€æ˜ï¼‰</li><li>âœ… æ§åˆ¶å™¨ä¹‹é—´å®Œå…¨ç‹¬ç«‹ï¼ˆæ— è€¦åˆï¼Œå¯å¹¶è¡Œå¼€å‘ï¼‰</li><li>âœ… é…ç½®é©±åŠ¨ï¼ˆYAML ä¿®æ”¹å³å¯å¯ç”¨&#x2F;ç¦ç”¨ï¼‰</li><li>âœ… æ˜“äºæµ‹è¯•ï¼ˆæ¯ä¸ªæ§åˆ¶å™¨å¯ç‹¬ç«‹å•å…ƒæµ‹è¯•ï¼‰</li></ul><hr><h2 id="ç¬¬å››éƒ¨åˆ†-ä¸-pluginlib-çš„å¯¹æ¯”"><a href="#ç¬¬å››éƒ¨åˆ†-ä¸-pluginlib-çš„å¯¹æ¯”" class="headerlink" title="ç¬¬å››éƒ¨åˆ† - ä¸ pluginlib çš„å¯¹æ¯”"></a>ç¬¬å››éƒ¨åˆ† - ä¸ pluginlib çš„å¯¹æ¯”</h2><h3 id="å¯¹æ¯”è¡¨"><a href="#å¯¹æ¯”è¡¨" class="headerlink" title="å¯¹æ¯”è¡¨"></a>å¯¹æ¯”è¡¨</h3><table><thead><tr><th>ç»´åº¦</th><th>å½“å‰æ–¹æ¡ˆ</th><th>pluginlib</th></tr></thead><tbody><tr><td><strong>åŠ è½½æ—¶æœº</strong></td><td>ç¼–è¯‘æœŸ</td><td>è¿è¡ŒæœŸ</td></tr><tr><td><strong>ç»‘å®šæ–¹å¼</strong></td><td>é™æ€é“¾æ¥</td><td>åŠ¨æ€åŠ è½½ï¼ˆdlopenï¼‰</td></tr><tr><td><strong>é…ç½®æ–‡ä»¶</strong></td><td>YAML</td><td>XML</td></tr><tr><td><strong>æ§åˆ¶å™¨æ•°é‡</strong></td><td>&lt; 50 ä¸ªé€‚åˆ</td><td>&gt; 50 ä¸ªé€‚åˆ</td></tr><tr><td><strong>æ€§èƒ½</strong></td><td>æä¼˜ï¼ˆ312x fasterï¼‰</td><td>è¶³å¤Ÿå¥½</td></tr><tr><td><strong>ä¿®æ”¹æ ¸å¿ƒä»£ç </strong></td><td>1 è¡Œ</td><td>0 è¡Œ</td></tr><tr><td><strong>å¼€å‘å‘¨æœŸ</strong></td><td>2-4 å°æ—¶</td><td>4-8 å°æ—¶</td></tr></tbody></table><h3 id="ä¸ªäººçš„å®æˆ˜é€‰æ‹©"><a href="#ä¸ªäººçš„å®æˆ˜é€‰æ‹©" class="headerlink" title="ä¸ªäººçš„å®æˆ˜é€‰æ‹©"></a>ä¸ªäººçš„å®æˆ˜é€‰æ‹©</h3><p>å¦ç™½è¯´ï¼Œæˆ‘æœ€åˆå°è¯•è¿‡ pluginlibï¼Œä½†å‘ç°å¯¹äºé¢‘ç¹è¿­ä»£çš„ç ”å‘é˜¶æ®µï¼Œå®ƒçš„ XML é…ç½®ã€plugin.xml æ–‡ä»¶ã€CMakeLists.txt ä¿®æ”¹å’Œç¼–è¯‘è¿‡ç¨‹åè€Œæ‹–æ…¢äº†å¼€å‘é€Ÿåº¦ã€‚</p><p>æˆ‘éœ€è¦çš„æ˜¯å¿«é€Ÿè¿­ä»£ã€å°‘å†²çªã€é«˜æ€§èƒ½çš„æ–¹æ¡ˆã€‚æ‰€ä»¥åœ¨å½“å‰é¡¹ç›®ä¸­é€‰æ‹©äº†è½»é‡çº§çš„å·¥å‚ Lambda æ–¹æ¡ˆã€‚</p><p><strong>å…³é”®æ˜¯</strong>ï¼šä¸€æ—¦ç³»ç»Ÿæˆç†Ÿã€æ§åˆ¶å™¨ç¨³å®šï¼Œæˆ‘ä¾ç„¶å¯ä»¥å¹³æ»‘è¿ç§»åˆ° pluginlibâ€”â€”ä¸¤è€…çš„åº•å±‚è®¾è®¡æ€æƒ³æ˜¯ä¸€è‡´çš„ï¼Œåªæ˜¯å®ç°æ–¹å¼ä¸åŒã€‚</p><h3 id="ä½•æ—¶é€‰æ‹©å“ªä¸ªæ–¹æ¡ˆ"><a href="#ä½•æ—¶é€‰æ‹©å“ªä¸ªæ–¹æ¡ˆ" class="headerlink" title="ä½•æ—¶é€‰æ‹©å“ªä¸ªæ–¹æ¡ˆ"></a>ä½•æ—¶é€‰æ‹©å“ªä¸ªæ–¹æ¡ˆ</h3><p><strong>é€‰æ‹©å½“å‰æ–¹æ¡ˆï¼ˆæ¨èï¼‰å¦‚æœ</strong>ï¼š</p><ul><li>æ§åˆ¶å™¨æ•°é‡ &lt; 50 ä¸ª</li><li>æ§åˆ¶å™¨ç”±åŒä¸€ä¸ªå›¢é˜Ÿç»´æŠ¤</li><li>ç³»ç»Ÿæ€§èƒ½è¦æ±‚é«˜</li><li>ä¸éœ€è¦è¿è¡Œæ—¶çƒ­åŠ è½½æ–°æ’ä»¶</li></ul><p><strong>é€‰æ‹© pluginlibï¼ˆæ¨èï¼‰å¦‚æœ</strong>ï¼š</p><ul><li>æ§åˆ¶å™¨æ•°é‡ &gt; 50 ä¸ª</li><li>ç”±å¤šä¸ªç‹¬ç«‹å›¢é˜Ÿè´¡çŒ®æ§åˆ¶å™¨</li><li>éœ€è¦æ”¯æŒç¬¬ä¸‰æ–¹æ’ä»¶</li><li>éœ€è¦è¿è¡Œæ—¶æ›´æ–°&#x2F;æ›¿æ¢æ§åˆ¶å™¨</li></ul><hr><h2 id="ç¬¬äº”éƒ¨åˆ†-ä¸ªäººåæ€"><a href="#ç¬¬äº”éƒ¨åˆ†-ä¸ªäººåæ€" class="headerlink" title="ç¬¬äº”éƒ¨åˆ† - ä¸ªäººåæ€"></a>ç¬¬äº”éƒ¨åˆ† - ä¸ªäººåæ€</h2><h3 id="5-1-è„æ¶æ„è®©æˆ‘åƒè¿‡çš„è‹¦"><a href="#5-1-è„æ¶æ„è®©æˆ‘åƒè¿‡çš„è‹¦" class="headerlink" title="5.1 è„æ¶æ„è®©æˆ‘åƒè¿‡çš„è‹¦"></a>5.1 è„æ¶æ„è®©æˆ‘åƒè¿‡çš„è‹¦</h3><p><strong>æƒ…æ™¯ 1</strong>ï¼šæ·»åŠ ç¬¬ 10 ä¸ªæ§åˆ¶å™¨</p><ul><li>ä¿®æ”¹æ ¸å¿ƒæ–‡ä»¶ 6-8 å¤„</li><li>æ·»åŠ  200-300 è¡Œä»£ç </li><li>èŠ±è´¹ 1-3 å¤©æ—¶é—´</li><li>æ‹…å¿ƒæ‰“ç ´å…¶ä»–æ§åˆ¶å™¨</li></ul><p><strong>æƒ…æ™¯ 2</strong>ï¼šä¸¤ä¸ªäººå¹¶è¡Œå¼€å‘</p><ul><li>é¢‘ç¹çš„ merge å†²çª</li><li>è§£å†³å†²çªéœ€è¦ 2+ å°æ—¶</li><li>å†²çªæœ¬ä¸åº”è¯¥å‘ç”Ÿ</li></ul><p><strong>æƒ…æ™¯ 3</strong>ï¼šè°ƒè¯• bug</p><ul><li>ä¸€ä¸ªå…³äºçº¿ç¨‹çš„ bug</li><li>æ•´ä¸ªæ–‡ä»¶ 700+ è¡Œ</li><li>èŠ±äº† 4 å°æ—¶æ‰æ‰¾åˆ°æ ¹æº</li></ul><p><strong>æƒ…æ™¯ 4</strong>ï¼šæ— æ³•ç¼–å†™å•å…ƒæµ‹è¯•</p><ul><li>CartesianVelocityController ç´§å¯†è€¦åˆ</li><li>æ— æ³•éš”ç¦»å•ç‹¬æµ‹è¯•</li><li>æµ‹è¯• CartesianVelocityController å°±æ„å‘³ç€è¦å¯åŠ¨æ•´ä¸ª StateMachine</li></ul><h3 id="5-2-æ¸…æ´è®¾è®¡çš„è½¬æŠ˜ç‚¹"><a href="#5-2-æ¸…æ´è®¾è®¡çš„è½¬æŠ˜ç‚¹" class="headerlink" title="5.2 æ¸…æ´è®¾è®¡çš„è½¬æŠ˜ç‚¹"></a>5.2 æ¸…æ´è®¾è®¡çš„è½¬æŠ˜ç‚¹</h3><p>å½“æ§åˆ¶å™¨æ•°é‡å¢é•¿åˆ° 7-8 ä¸ªæ—¶ï¼Œæˆ‘æ„è¯†åˆ°è¿™ç§æ¶æ„å·²ç»å¿«åˆ°ä¸´ç•Œç‚¹ã€‚</p><p><strong>æ¶æ„æ¼”åŒ–çš„åˆ†ç•Œçº¿</strong>ï¼šé€šå¸¸ï¼Œå½“ä»¥ä¸‹ä¸¤ä¸ªæ¡ä»¶ä¹‹ä¸€å‡ºç°æ—¶ï¼Œå°±æ˜¯æ¶æ„å¿…é¡»é‡æ„çš„ä¿¡å·ï¼š</p><ol><li><strong>åŠŸèƒ½æ•°è¶…è¿‡ 5-7 ä¸ª</strong>ï¼Œä¸”æ ¸å¿ƒæ–‡ä»¶å˜å¾—éš¾ä»¥ç»´æŠ¤ï¼ˆ800+ è¡Œï¼‰</li><li><strong>å‡ºç°ç¬¬ä¸€æ¬¡ã€ŒåŠ åŠŸèƒ½æ¯”ä¿® bug è¿˜éš¾ã€çš„æ—¶åˆ»</strong>â€”â€”æ¯ä¸ªæ–°åŠŸèƒ½éƒ½è¦è§¦åŠå¤šä¸ªåœ°æ–¹ï¼Œé£é™©æ— æ³•æ§åˆ¶</li></ol><p>å¯¹æˆ‘æ¥è¯´ï¼Œä¸¤ä¸ªæ¡ä»¶éƒ½å‡ºç°äº†ã€‚æ–°å¢ä¸€ä¸ªæ§åˆ¶å™¨éœ€è¦æ”¹ 6-8 å¤„åœ°æ–¹ï¼Œå˜æˆäº†ã€Œé«˜é£é™©çš„é‡ä½“åŠ›æ´»ã€ã€‚</p><p><strong>æˆ‘çš„å†³å®š</strong>ï¼šé‡æ–°è®¾è®¡ï¼ŒåŸºäºä»¥ä¸‹åŸåˆ™ï¼š</p><ol><li><strong>æ¯ä¸ªæ§åˆ¶å™¨åº”è¯¥ç‹¬ç«‹</strong></li><li><strong>é…ç½®ä¸åº”è¯¥åœ¨ä»£ç ä¸­</strong></li><li><strong>æ·»åŠ æ–°åŠŸèƒ½ä¸åº”è¯¥ä¿®æ”¹æ ¸å¿ƒä»£ç </strong></li><li><strong>åº”è¯¥å¯ä»¥ç‹¬ç«‹æµ‹è¯•</strong></li></ol><h3 id="5-3-è¿ç§»çš„æ”¶ç›Š"><a href="#5-3-è¿ç§»çš„æ”¶ç›Š" class="headerlink" title="5.3 è¿ç§»çš„æ”¶ç›Š"></a>5.3 è¿ç§»çš„æ”¶ç›Š</h3><p>è¿ç§»åˆ°æ¸…æ´è®¾è®¡åï¼Œ3 å‘¨å†…æˆ‘æ·»åŠ äº† 8 ä¸ªæ–°æ§åˆ¶å™¨ã€‚</p><p><strong>å…³é”®æ•°æ®</strong>ï¼š</p><ul><li>æ¯ä¸ªæ–°æ§åˆ¶å™¨çš„å¼€å‘æ—¶é—´ï¼šä» 1-3 å¤© â†’ 2-4 å°æ—¶</li><li>æ ¸å¿ƒæ–‡ä»¶è¡Œæ•°ï¼šä¿æŒç¨³å®šï¼ˆ300 è¡Œ â†’ 310 è¡Œï¼‰</li><li>Merge å†²çªï¼šä»é¢‘ç¹ â†’ åŸºæœ¬ä¸å‡ºç°</li><li>å•å…ƒæµ‹è¯•ï¼šä»ä¸å¯èƒ½ â†’ è½»è€Œæ˜“ä¸¾</li></ul><h3 id="5-4-å…³é”®é¢†æ‚Ÿ"><a href="#5-4-å…³é”®é¢†æ‚Ÿ" class="headerlink" title="5.4 å…³é”®é¢†æ‚Ÿ"></a>5.4 å…³é”®é¢†æ‚Ÿ</h3><p><strong>ã€Œå½“ä»£ç çš„å¢é•¿å‘ˆæŒ‡æ•°çº§å¢åŠ æ—¶ï¼Œæ˜¯æ¶æ„å‡ºé—®é¢˜äº†ï¼Œè€Œä¸æ˜¯å®ç°å‡ºé—®é¢˜ã€‚ã€</strong></p><p>è„æ¶æ„çš„æ ¹æœ¬é—®é¢˜ä¸åœ¨äºæŸä¸ªæ§åˆ¶å™¨çš„å®ç°ä¸å¥½ï¼Œè€Œåœ¨äºç®¡ç†è¿™äº›æ§åˆ¶å™¨çš„æ–¹å¼æœ¬èº«å°±æ˜¯è„†å¼±çš„ã€‚</p><p><strong>ä¸€ä¸ªéšå–»</strong>ï¼šå½“æˆ‘åˆ æ‰é‚£ 500 è¡Œ switch-case æ—¶ï¼Œæˆ‘æ„è¯†åˆ°â€”â€”å¥½çš„æ¶æ„ä¸åªæ˜¯ä»£ç æ•´æ´ï¼Œè€Œæ˜¯<strong>å¼€å‘è€…èƒ½å‘¼å¸çš„ç©ºé—´</strong>ã€‚</p><p>åœ¨è„æ¶æ„ä¸‹ï¼Œæˆ‘æ€»æ˜¯æˆ˜æˆ˜å…¢å…¢åœ°ä¿®æ”¹ä»£ç ï¼Œæ‹…å¿ƒæ‰“ç ´æŸå¤„çš„å¾®å¦™å¹³è¡¡ã€‚åœ¨æ¸…æ´æ¶æ„ä¸‹ï¼Œæˆ‘å¯ä»¥ä¸“æ³¨äºä¸šåŠ¡é€»è¾‘æœ¬èº«ï¼Œä¿¡ä»»ç³»ç»Ÿçš„è¾¹ç•Œå’Œçº¦æŸã€‚</p><hr><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><h3 id="ä»è„åˆ°æ¸…æ´çš„å…³é”®æ´å¯Ÿ"><a href="#ä»è„åˆ°æ¸…æ´çš„å…³é”®æ´å¯Ÿ" class="headerlink" title="ä»è„åˆ°æ¸…æ´çš„å…³é”®æ´å¯Ÿ"></a>ä»è„åˆ°æ¸…æ´çš„å…³é”®æ´å¯Ÿ</h3><table><thead><tr><th>é—®é¢˜</th><th>è„æ¶æ„çš„åšæ³•</th><th>æ¸…æ´è®¾è®¡çš„åšæ³•</th><th>æ”¶ç›Š</th></tr></thead><tbody><tr><td>å¦‚ä½•å®šä¹‰æ–°æ¨¡å¼ï¼Ÿ</td><td>ä¿®æ”¹æšä¸¾</td><td>YAML é…ç½®</td><td>æ— éœ€æ”¹ä»£ç </td></tr><tr><td>å¦‚ä½•åˆå§‹åŒ–æ§åˆ¶å™¨ï¼Ÿ</td><td>ç¡¬ç¼–ç  switch-case</td><td>å·¥å‚ Lambda</td><td>è‡ªåŠ¨åŒ–ã€å¯æ‰©å±•</td></tr><tr><td>å¦‚ä½•å¤„ç†ä¸åŒæ¶ˆæ¯ç±»å‹ï¼Ÿ</td><td>void* è½¬å‹ï¼ˆå±é™©ï¼‰</td><td>std::any + æ¨¡æ¿ï¼ˆå®‰å…¨ï¼‰</td><td>ç¼–è¯‘æœŸæ£€æŸ¥</td></tr><tr><td>å¦‚ä½•ä½¿ç”¨æ–°æ§åˆ¶å™¨ï¼Ÿ</td><td>ä¿®æ”¹ 3+ å¤„åœ°æ–¹</td><td>ä»…ä¿®æ”¹ registry.cpp + YAML</td><td>é™ä½é”™è¯¯é£é™©</td></tr><tr><td>å¯ä»¥æ”¯æŒå¤šå°‘ä¸ªæ§åˆ¶å™¨ï¼Ÿ</td><td>&lt; 10ï¼ˆå¼€å§‹æ··ä¹±ï¼‰</td><td>50+ ï¼ˆä»ç„¶æ¸…æ™°ï¼‰</td><td>å¯æ‰©å±•æ€§</td></tr></tbody></table><h3 id="è®¾è®¡åŸåˆ™æ€»ç»“"><a href="#è®¾è®¡åŸåˆ™æ€»ç»“" class="headerlink" title="è®¾è®¡åŸåˆ™æ€»ç»“"></a>è®¾è®¡åŸåˆ™æ€»ç»“</h3><ol><li><strong>é…ç½®é©±åŠ¨</strong>ï¼šç”¨æ•°æ®ï¼ˆYAMLï¼‰è¡¨è¾¾ç»“æ„ï¼Œè€Œéç¡¬ç¼–ç </li><li><strong>å·¥å‚æ¨¡å¼</strong>ï¼šå»¶è¿Ÿå¯¹è±¡åˆ›å»ºï¼Œè§£è€¦ä¾èµ–</li><li><strong>å•ä¾‹æ³¨å†Œè¡¨</strong>ï¼šå…¨å±€å”¯ä¸€çš„â€é»„é¡µâ€</li><li><strong>ç±»å‹å®‰å…¨</strong>ï¼šç¼–è¯‘æœŸé”™è¯¯ &gt; è¿è¡ŒæœŸé”™è¯¯</li><li><strong>æ¾è€¦åˆ</strong>ï¼šæ–°æ§åˆ¶å™¨æ— éœ€ä¿®æ”¹æ ¸å¿ƒä»£ç </li></ol><h3 id="æœ€åçš„è¯"><a href="#æœ€åçš„è¯" class="headerlink" title="æœ€åçš„è¯"></a>æœ€åçš„è¯</h3><p>è¿™å¥—è®¾è®¡æ–¹æ¡ˆæ˜¯åœ¨<strong>æ€§èƒ½ã€æ˜“ç”¨æ€§ã€å¯æ‰©å±•æ€§</strong>ä¹‹é—´çš„ç²¾å¿ƒæƒè¡¡ï¼š</p><ul><li>å¦‚æœä½ éœ€è¦æè‡´æ€§èƒ½ â†’ å½“å‰æ–¹æ¡ˆæ›´ä¼˜</li><li>å¦‚æœä½ éœ€è¦æè‡´çµæ´»æ€§ â†’ pluginlib æ›´ä¼˜</li><li>å¦‚æœä½ éœ€è¦å¹³è¡¡ â†’ å½“å‰æ–¹æ¡ˆè¶³ä»¥åº”å¯¹æœªæ¥ 3-5 å¹´çš„å¢é•¿</li></ul><p><strong>å…³é”®æ˜¯</strong>ï¼šç†è§£è¿™ä¸¤ç§è®¾è®¡çš„å“²å­¦ï¼Œæ ¹æ®ä½ çš„å®é™…éœ€æ±‚åšå‡ºé€‰æ‹©ã€‚</p><p>æ¶æ„è®¾è®¡çš„è‰ºæœ¯ï¼Œå°±åœ¨äºæ­¤ã€‚</p><hr><h2 id="ä¸Šç¯‡å›é¡¾"><a href="#ä¸Šç¯‡å›é¡¾" class="headerlink" title="ä¸Šç¯‡å›é¡¾"></a>ä¸Šç¯‡å›é¡¾</h2><p>æƒ³å›é¡¾é—®é¢˜è¯Šæ–­ï¼Ÿ <a href="/2025/11/01/%E4%BB%8E%E7%A1%AC%E7%BC%96%E7%A0%81%E5%88%B0%E6%8F%92%E4%BB%B6%E5%8C%96%EF%BC%88%E4%B8%8A%E7%AF%87%EF%BC%89%EF%BC%9A%E8%84%8F%E6%9E%B6%E6%9E%84%E7%9A%84%E9%97%AE%E9%A2%98%E8%AF%8A%E6%96%AD/">æŸ¥çœ‹ä¸Šç¯‡ï¼šè„æ¶æ„çš„é—®é¢˜è¯Šæ–­</a></p>]]></content>
    
    
    <summary type="html">æœ¬æ–‡å±•ç¤ºæˆ‘å¦‚ä½•ä»¥æ¸…æ´æ¶æ„æ€æƒ³é‡æ„æ§åˆ¶å™¨æ³¨å†Œæœºåˆ¶ï¼Œæ„å»ºä¸€ä¸ªæ¨¡å—åŒ–ã€å¯é…ç½®ã€å¯æ‰©å±•çš„æœºå™¨äººæ§åˆ¶ç³»ç»Ÿã€‚</summary>
    
    
    
    <category term="æ§åˆ¶æ¶æ„ç¯‡-ä»æ¨¡å¼åˆ°å·¥å‚" scheme="http://ding-kaiyue.github.io/categories/%E6%8E%A7%E5%88%B6%E6%9E%B6%E6%9E%84%E7%AF%87-%E4%BB%8E%E6%A8%A1%E5%BC%8F%E5%88%B0%E5%B7%A5%E5%8E%82/"/>
    
    
    <category term="C++" scheme="http://ding-kaiyue.github.io/tags/C/"/>
    
    <category term="ROS2" scheme="http://ding-kaiyue.github.io/tags/ROS2/"/>
    
    <category term="æ¶æ„è®¾è®¡" scheme="http://ding-kaiyue.github.io/tags/%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1/"/>
    
    <category term="å·¥å‚æ¨¡å¼" scheme="http://ding-kaiyue.github.io/tags/%E5%B7%A5%E5%8E%82%E6%A8%A1%E5%BC%8F/"/>
    
  </entry>
  
  <entry>
    <title>ä»ç¡¬ç¼–ç åˆ°æ’ä»¶åŒ–ï¼ˆä¸Šç¯‡ï¼‰ï¼šè„æ¶æ„çš„é—®é¢˜è¯Šæ–­</title>
    <link href="http://ding-kaiyue.github.io/2025/11/01/%E4%BB%8E%E7%A1%AC%E7%BC%96%E7%A0%81%E5%88%B0%E6%8F%92%E4%BB%B6%E5%8C%96%EF%BC%88%E4%B8%8A%E7%AF%87%EF%BC%89%EF%BC%9A%E8%84%8F%E6%9E%B6%E6%9E%84%E7%9A%84%E9%97%AE%E9%A2%98%E8%AF%8A%E6%96%AD/"/>
    <id>http://ding-kaiyue.github.io/2025/11/01/%E4%BB%8E%E7%A1%AC%E7%BC%96%E7%A0%81%E5%88%B0%E6%8F%92%E4%BB%B6%E5%8C%96%EF%BC%88%E4%B8%8A%E7%AF%87%EF%BC%89%EF%BC%9A%E8%84%8F%E6%9E%B6%E6%9E%84%E7%9A%84%E9%97%AE%E9%A2%98%E8%AF%8A%E6%96%AD/</id>
    <published>2025-11-01T10:15:00.000Z</published>
    <updated>2025-11-03T00:57:32.152Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>è¿™æ˜¯ä¸€ç¯‡å…³äºæœºå™¨äººæ§åˆ¶ç³»ç»Ÿæ¶æ„è®¾è®¡çš„æ·±åº¦åˆ†æï¼Œæ­ç¤ºä¸ºä»€ä¹ˆç®€å•å †ç§¯ä»£ç çš„æ–¹å¼ä¼šå¯¼è‡´ç³»ç»Ÿå˜å¾—è¶Šæ¥è¶Šè„†å¼±ã€‚</p></blockquote><p><strong>æœ¬æ–‡é€‚åˆ</strong>ï¼šæ¶æ„è®¾è®¡å¸ˆã€ROS2 å¼€å‘è€…ã€ä»¥åŠå…³å¿ƒä»£ç è´¨é‡çš„å·¥ç¨‹å¸ˆ</p><p><strong>å†…å®¹</strong>ï¼šä»çœŸå®çš„æ··ä¹±ä»£ç å¼€å§‹ï¼Œåˆ†æ 8 ä¸ªä¸¥é‡çš„æ¶æ„é—®é¢˜ï¼Œç„¶åé€šè¿‡ SOLID åŸåˆ™æ­ç¤ºè¿™äº›é—®é¢˜çš„æ ¹æœ¬åŸå› ã€‚</p><hr><h2 id="ğŸ“–-æœ¬ç¯‡å†…å®¹"><a href="#ğŸ“–-æœ¬ç¯‡å†…å®¹" class="headerlink" title="ğŸ“– æœ¬ç¯‡å†…å®¹"></a>ğŸ“– æœ¬ç¯‡å†…å®¹</h2><ol><li><strong><a href="#%E5%BC%80%E7%AF%87-%E4%B8%80%E4%B8%AA%E7%8E%B0%E5%AE%9E%E7%9A%84%E5%9B%B0%E5%A2%83">å¼€ç¯‡ï¼šç°å®çš„å›°å¢ƒ</a></strong></li><li><strong><a href="#%E7%AC%AC%E4%B8%80%E9%83%A8%E5%88%86-%E8%84%8F%E6%9E%B6%E6%9E%84%E7%9A%84%E9%97%AE%E9%A2%98">è„æ¶æ„çš„é—®é¢˜</a></strong><ul><li><a href="#11-%E5%85%B8%E5%9E%8B%E7%9A%84%E8%84%8F%E6%9E%B6%E6%9E%84%E6%98%AF%E8%BF%99%E6%A0%B7%E7%9A%84">1.1 çœŸå®çš„æ··ä¹±ä»£ç ç¤ºä¾‹</a></li><li><a href="#12-%E8%BF%99%E4%B8%AA%E6%9E%B6%E6%9E%84%E6%9A%B4%E9%9C%B2%E7%9A%84-8-%E4%B8%AA%E4%B8%A5%E9%87%8D%E9%97%AE%E9%A2%98">1.2 å…«ä¸ªä¸¥é‡é—®é¢˜çš„å…·ä½“åˆ†æ</a></li><li><a href="#13-%E9%97%AE%E9%A2%98%E7%9A%84%E6%A0%B9%E6%9C%AC%E5%8E%9F%E5%9B%A0">1.3 é—®é¢˜çš„æ ¹æœ¬åŸå› </a></li><li><a href="#%E7%AC%AC%E4%B8%80%E9%83%A8%E5%88%86%E7%BB%AD8-%E4%B8%AA%E9%97%AE%E9%A2%98%E9%80%9F%E8%A7%88">1.4 é—®é¢˜é€Ÿè§ˆä¸ç—‡çŠ¶æ€»ç»“</a></li></ul></li><li><strong><a href="#solid-principles">SOLID åŸåˆ™ï¼šç†è®ºåŸºç¡€</a></strong></li></ol><hr><h2 id="å¼€ç¯‡-ä¸€ä¸ªç°å®çš„å›°å¢ƒ"><a href="#å¼€ç¯‡-ä¸€ä¸ªç°å®çš„å›°å¢ƒ" class="headerlink" title="å¼€ç¯‡ - ä¸€ä¸ªç°å®çš„å›°å¢ƒ"></a>å¼€ç¯‡ - ä¸€ä¸ªç°å®çš„å›°å¢ƒ</h2><p>æƒ³è±¡ä¸€ä¸‹ï¼Œä½ æ­£åœ¨å¼€å‘ä¸€ä¸ªæœºå™¨äººæ§åˆ¶ç³»ç»Ÿã€‚ç³»ç»Ÿéœ€è¦æ”¯æŒå¤šç§è¿åŠ¨æ¨¡å¼ï¼š</p><ul><li>å…³èŠ‚é€Ÿåº¦æ§åˆ¶ï¼ˆJointVelocityï¼‰</li><li>ç¬›å¡å°”ç©ºé—´é€Ÿåº¦æ§åˆ¶ï¼ˆCartesianVelocityï¼‰</li><li>å…³èŠ‚ç©ºé—´æ’å€¼ï¼ˆMoveJï¼‰</li><li>ç›´çº¿è¿åŠ¨ï¼ˆMoveLï¼‰</li><li>åœ†å¼§è¿åŠ¨ï¼ˆMoveCï¼‰</li><li>è½¨è¿¹å›æ”¾ï¼ˆTrajectoryReplayï¼‰</li><li>â€¦</li></ul><p>æ¯ä¸ªæ¨¡å¼éƒ½æ˜¯ä¸€ä¸ªå®Œæ•´çš„æ§åˆ¶ç®—æ³•ï¼Œéœ€è¦ç‹¬ç«‹çš„æ¶ˆæ¯å¤„ç†ã€å‚æ•°ç®¡ç†ã€çŠ¶æ€ç»´æŠ¤ã€‚éšç€åŠŸèƒ½çš„å¢åŠ ï¼Œç³»ç»Ÿå˜å¾—è¶Šæ¥è¶Šå¤æ‚ã€‚</p><p><strong>é—®é¢˜æ¥äº†</strong>ï¼šå½“ä½ éœ€è¦æ·»åŠ æ–°çš„è¿åŠ¨æ¨¡å¼æ—¶ï¼Œä½ è¦æ”¹åŠ¨å“ªäº›åœ°æ–¹ï¼Ÿ</p><p>å¯¹æˆ‘æ¥è¯´ï¼Œè¿™ä¸ªé—®é¢˜çš„ç­”æ¡ˆä¸€å¼€å§‹éå¸¸â€ç›´æ¥â€â€”â€”æˆ‘åœ¨ä¸»æ§åˆ¶èŠ‚ç‚¹ï¼ˆStateMachineï¼‰é‡Œæ·»åŠ æ–°çš„å›è°ƒã€è®¢é˜…æ–°çš„è¯é¢˜ã€ä¿®æ”¹çŠ¶æ€æœºé€»è¾‘â€¦â€¦ä¸€åˆ‡éƒ½åœ¨ä¸€ä¸ªæ–‡ä»¶é‡Œå®Œæˆã€‚</p><p>å®ƒâ€èƒ½è·‘â€ï¼Œç”šè‡³èƒ½è¿è¡Œå¾—ç›¸å½“ä¸é”™ã€‚ä½†éšç€æ¨¡å¼æ•°é‡å¢åŠ åˆ° 10ã€15ã€20 ä¸ªï¼Œé—®é¢˜å¼€å§‹æµ®ç°ã€‚</p><p>æ¯æ¬¡æ·»åŠ ä¸€ä¸ªæ–°çš„æ§åˆ¶æ¨¡å¼ï¼Œæˆ‘éƒ½è¦æ‰“å¼€é‚£ä¸ªè¶Šæ¥è¶Šè†¨èƒ€çš„æ–‡ä»¶ã€‚å…‰æ˜¯æ‰¾åˆ°è¦æ”¹çš„å‡½æ•°ï¼Œå°±è¦æ»šåŠ¨å¥½åŠå¤©ã€‚æ”¹å®Œäº†ä¸€ä¸ª caseï¼Œåˆå¾—ç¥ˆç¥·ä¸ä¼šæ‰“æ–­åˆ«çš„æ¨¡å¼ã€‚ä¸¤ä¸ªäººå¹¶è¡Œå¼€å‘ä¸¤ä¸ªæ–°æ¨¡å¼ï¼Ÿé‚£å°±å‡†å¤‡å¥½è§£å†³ merge å†²çªå§ã€‚</p><p>ç³»ç»Ÿå˜å¾—è¶Šæ¥è¶Šè‡ƒè‚¿ã€è¶Šæ¥è¶Šè„†å¼±ã€‚ä¿®æ”¹ä¸€ä¸ªåœ°æ–¹è¦æ‹…å¿ƒæ‰“ç ´å¦ä¸€ä¸ªåœ°æ–¹ã€‚è¿™ï¼Œå°±æ˜¯æˆ‘åæ¥ç§°ä¹‹ä¸ºçš„ <strong>â€œè„æ¶æ„ï¼ˆDirty Architectureï¼‰â€</strong>â€”â€”ä¸æ˜¯è¯´ä»£ç è´¨é‡å·®ï¼Œè€Œæ˜¯è¯´<strong>èŒè´£æ··ä¹±ã€è€¦åˆä¸¥é‡ã€æ— æ³•ä¼˜é›…æ‰©å±•</strong>ã€‚</p><p>æ‰€è°“è„æ¶æ„ï¼Œä¸æ˜¯æŒ‡ä»£ç å†™å¾—ä¸‘ï¼Œè€Œæ˜¯æŒ‡ç³»ç»Ÿçš„ç»“æ„æ— æ³•æ”¯æ’‘é•¿æœŸæ¼”åŒ–ã€‚å®ƒèƒ½å·¥ä½œï¼Œä½†æ— æ³•æˆé•¿ã€‚</p><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ä»é‚£æ®µæ—©æœŸçš„çœŸå®ä»£ç å¼€å§‹ï¼Œçœ‹çœ‹å®ƒåˆ°åº•â€è„â€åœ¨å“ªé‡Œâ€”â€”ä»¥åŠä¸ºä»€ä¹ˆä¼šå˜æˆè¿™æ ·ã€‚</p><hr><h2 id="å¿«é€Ÿå¯¹æ¯”ï¼šä»è„åˆ°æ¸…æ´çš„æ¼”å˜"><a href="#å¿«é€Ÿå¯¹æ¯”ï¼šä»è„åˆ°æ¸…æ´çš„æ¼”å˜" class="headerlink" title="å¿«é€Ÿå¯¹æ¯”ï¼šä»è„åˆ°æ¸…æ´çš„æ¼”å˜"></a>å¿«é€Ÿå¯¹æ¯”ï¼šä»è„åˆ°æ¸…æ´çš„æ¼”å˜</h2><p>åœ¨æ·±å…¥é—®é¢˜ä¹‹å‰ï¼Œè®©æˆ‘ä»¬å…ˆçœ‹ä¸€ä¸ªâ€ç›®æ ‡â€â€”â€”è¿™æ ·ä½ èƒ½ç†è§£æˆ‘ä»¬è¦è§£å†³ä»€ä¹ˆé—®é¢˜ï¼š</p><table><thead><tr><th>æ¶æ„ç»´åº¦</th><th>è„æ¶æ„ï¼ˆBeforeï¼‰</th><th>æ¸…æ´æ¶æ„ï¼ˆAfterï¼‰</th></tr></thead><tbody><tr><td><strong>æ§åˆ¶å™¨æ³¨å†Œ</strong></td><td>æ‰‹å†™ if-else &#x2F; switch-case</td><td>åŠ¨æ€æ³¨å†Œï¼ˆå·¥å‚ + YAMLï¼‰</td></tr><tr><td><strong>æ§åˆ¶å™¨åˆ›å»º</strong></td><td>new + æ‰‹åŠ¨ç®¡ç†</td><td>å·¥å‚æ–¹æ³•è‡ªåŠ¨åˆ›å»º</td></tr><tr><td><strong>æ·»åŠ æ–°æ¨¡å¼</strong></td><td>ä¿®æ”¹æ ¸å¿ƒæ–‡ä»¶ 6-8 å¤„</td><td>æ·»åŠ ç‹¬ç«‹ç±»æ–‡ä»¶ + æ”¹ 1 è¡Œ registry</td></tr><tr><td><strong>é€šä¿¡æ¥å£</strong></td><td>ç›´æ¥ ROS è®¢é˜…æ··åœ¨é€»è¾‘é‡Œ</td><td>ç»Ÿä¸€çš„æŠ½è±¡æ¥å£ï¼ˆModeControllerBaseï¼‰</td></tr><tr><td><strong>é…ç½®æ–¹å¼</strong></td><td>ç¡¬ç¼–ç åœ¨ä»£ç ä¸­</td><td>YAML é…ç½®é©±åŠ¨</td></tr><tr><td><strong>æ ¸å¿ƒä»£ç å˜åŒ–</strong></td><td>éšåŠŸèƒ½æ•°é‡çº¿æ€§å¢é•¿</td><td>ä¿æŒç¨³å®šï¼ˆä¸åŠŸèƒ½æ•°æ— å…³ï¼‰</td></tr><tr><td><strong>å¼€å‘å‘¨æœŸ</strong></td><td>1-3 å¤©&#x2F;æ§åˆ¶å™¨</td><td>2-4 å°æ—¶&#x2F;æ§åˆ¶å™¨</td></tr><tr><td><strong>å¯æµ‹è¯•æ€§</strong></td><td>æ— æ³•å•ç‹¬æµ‹è¯•</td><td>æ§åˆ¶å™¨ç‹¬ç«‹å¯æµ‹</td></tr></tbody></table><p>çœ‹è¿™ä¸ªå¯¹æ¯”è¡¨ï¼Œä½ ä¼šå‘ç°ï¼šè„æ¶æ„çš„æ ¸å¿ƒé—®é¢˜æ˜¯<strong>æ·»åŠ æ–°åŠŸèƒ½è¦æ”¹åŠ¨æ ¸å¿ƒä»£ç </strong>ï¼›æ¸…æ´æ¶æ„çš„æ ¸å¿ƒä¼˜åŠ¿æ˜¯<strong>æ·»åŠ æ–°åŠŸèƒ½æ— éœ€æ”¹åŠ¨æ ¸å¿ƒä»£ç </strong>ã€‚</p><p>è¿™å°±æ˜¯æˆ‘ä»¬åœ¨ä¸‹ç¯‡è¦å®ç°çš„ç›®æ ‡ã€‚</p><hr><h2 id="ç¬¬ä¸€éƒ¨åˆ†-è„æ¶æ„çš„é—®é¢˜"><a href="#ç¬¬ä¸€éƒ¨åˆ†-è„æ¶æ„çš„é—®é¢˜" class="headerlink" title="ç¬¬ä¸€éƒ¨åˆ† - è„æ¶æ„çš„é—®é¢˜"></a>ç¬¬ä¸€éƒ¨åˆ† - è„æ¶æ„çš„é—®é¢˜</h2><h3 id="1-1-å…¸å‹çš„è„æ¶æ„æ˜¯è¿™æ ·çš„"><a href="#1-1-å…¸å‹çš„è„æ¶æ„æ˜¯è¿™æ ·çš„" class="headerlink" title="1.1 å…¸å‹çš„è„æ¶æ„æ˜¯è¿™æ ·çš„"></a>1.1 å…¸å‹çš„è„æ¶æ„æ˜¯è¿™æ ·çš„</h3><p>è¿™æ˜¯æˆ‘çš„çœŸå®é¡¹ç›® <code>orz_robot</code> ä¸­æ—©æœŸçš„ä»£ç ç‰‡æ®µã€‚çœ‹çœ‹æ„é€ å‡½æ•°é‡Œå‘ç”Ÿäº†ä»€ä¹ˆï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// robot_state_machine.hpp / robot_state_machine.cpp</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">StateMachine</span> : <span class="keyword">public</span> rclcpp::Node &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    std::map&lt;<span class="type">uint8_t</span>, std::shared_ptr&lt;ModeControllerBase&gt;&gt; controller_map_;</span><br><span class="line">    <span class="type">uint8_t</span> current_mode_;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">StateMachine</span>(std::string node_name) : <span class="built_in">Node</span>(node_name), <span class="built_in">qos</span>(<span class="number">10</span>) &#123;</span><br><span class="line">        <span class="comment">// é—®é¢˜ 1: å¤§é‡çš„è®¢é˜…ç›´æ¥åœ¨æ„é€ å‡½æ•°é‡Œç¡¬ç¼–ç </span></span><br><span class="line">        mode_sub = <span class="keyword">this</span>-&gt;<span class="built_in">create_subscription</span>&lt;std_msgs::msg::UInt8&gt;(</span><br><span class="line">            <span class="string">&quot;robotic_arm_control_mode&quot;</span>, qos,</span><br><span class="line">            std::<span class="built_in">bind</span>(&amp;StateMachine::working_mode_callback, <span class="keyword">this</span>, std::placeholders::_1));</span><br><span class="line"></span><br><span class="line">        jointctrl_sub_ = <span class="keyword">this</span>-&gt;<span class="built_in">create_subscription</span>&lt;robot_interfaces::msg::KeyPressedAction&gt;(</span><br><span class="line">            <span class="string">&quot;jointctrl_action&quot;</span>, qos,</span><br><span class="line">            std::<span class="built_in">bind</span>(&amp;StateMachine::jointctrl_action_callback, <span class="keyword">this</span>, std::placeholders::_1));</span><br><span class="line"></span><br><span class="line">        cartesian_sub_ = <span class="keyword">this</span>-&gt;<span class="built_in">create_subscription</span>&lt;robot_interfaces::msg::KeyPressedAction&gt;(</span><br><span class="line">            <span class="string">&quot;cartesian_action&quot;</span>, qos,</span><br><span class="line">            std::<span class="built_in">bind</span>(&amp;StateMachine::cartesian_action_callback, <span class="keyword">this</span>, std::placeholders::_1));</span><br><span class="line"></span><br><span class="line">        movej_sub_ = <span class="keyword">this</span>-&gt;<span class="built_in">create_subscription</span>&lt;std_msgs::msg::Float64MultiArray&gt;(</span><br><span class="line">            <span class="string">&quot;movej_action&quot;</span>, qos,</span><br><span class="line">            std::<span class="built_in">bind</span>(&amp;StateMachine::movej_action_callback, <span class="keyword">this</span>, std::placeholders::_1));</span><br><span class="line"></span><br><span class="line">        movel_sub_ = <span class="keyword">this</span>-&gt;<span class="built_in">create_subscription</span>&lt;std_msgs::msg::Float64MultiArray&gt;(</span><br><span class="line">            <span class="string">&quot;movel_action&quot;</span>, qos,</span><br><span class="line">            std::<span class="built_in">bind</span>(&amp;StateMachine::movel_action_callback, <span class="keyword">this</span>, std::placeholders::_1));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ... è¿˜æœ‰æ›´å¤šè®¢é˜… ...</span></span><br><span class="line">        <span class="comment">// è¿™é‡Œå·²ç»æœ‰ 10+ ä¸ªè®¢é˜…ï¼Œå…¨éƒ¨åœ¨æ„é€ å‡½æ•°ä¸­ç¡¬ç¼–ç ï¼</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">working_mode_callback</span><span class="params">(<span class="type">const</span> std_msgs::msg::UInt8::SharedPtr msg)</span> </span>&#123;</span><br><span class="line">        current_mode_ = msg-&gt;data;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// é—®é¢˜ 2: æ‰€æœ‰æ¨¡å¼çš„é€»è¾‘éƒ½åœ¨ä¸€ä¸ªå·¨å¤§çš„ switch ä¸­</span></span><br><span class="line">        <span class="keyword">switch</span> (current_mode_) &#123;</span><br><span class="line">            <span class="keyword">case</span> BACKTOSTART: &#123;</span><br><span class="line">                std::vector&lt;<span class="type">double</span>&gt; target_joint_positions = &#123;<span class="number">0.0f</span>, <span class="number">0.0f</span>, <span class="number">0.0f</span>, <span class="number">0.0f</span>, <span class="number">0.0f</span>, <span class="number">0.0f</span>&#125;;</span><br><span class="line">                kinematics_-&gt;<span class="built_in">moveToJointPositions</span>(target_joint_positions);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">case</span> DISABLE: &#123;</span><br><span class="line">                <span class="keyword">auto</span> motor_control_msg = kinematics_-&gt;<span class="built_in">motor_disable</span>();</span><br><span class="line">                motor_msg_pub-&gt;<span class="built_in">publish</span>(motor_control_msg);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// ... è¿˜æœ‰åå‡ ä¸ª caseï¼Œæ¯ä¸ªå‡ åè¡Œä»£ç  ...</span></span><br><span class="line">            <span class="comment">// è¿™ä¸ªå‡½æ•°æœ‰ 200+ è¡Œï¼</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h3 id="1-2-è¿™ä¸ªæ¶æ„æš´éœ²çš„-8-ä¸ªä¸¥é‡é—®é¢˜"><a href="#1-2-è¿™ä¸ªæ¶æ„æš´éœ²çš„-8-ä¸ªä¸¥é‡é—®é¢˜" class="headerlink" title="1.2 è¿™ä¸ªæ¶æ„æš´éœ²çš„ 8 ä¸ªä¸¥é‡é—®é¢˜"></a>1.2 è¿™ä¸ªæ¶æ„æš´éœ²çš„ 8 ä¸ªä¸¥é‡é—®é¢˜</h3><p>è¿™ 8 ä¸ªé—®é¢˜çœ‹ä¼¼ç‹¬ç«‹ï¼Œä½†å…¶å®å¯ä»¥åˆ†æˆä¸‰å¤§ç±»ã€‚è®©æˆ‘ä¸€ä¸ªä¸ªè®²è§£ï¼š</p><h4 id="ğŸ”—-ç¬¬ä¸€ç±»ï¼šæ¶æ„å¤æ‚åº¦é—®é¢˜ï¼ˆèŒè´£æ··ä¹±ã€è€¦åˆåº¦é«˜ï¼‰"><a href="#ğŸ”—-ç¬¬ä¸€ç±»ï¼šæ¶æ„å¤æ‚åº¦é—®é¢˜ï¼ˆèŒè´£æ··ä¹±ã€è€¦åˆåº¦é«˜ï¼‰" class="headerlink" title="ğŸ”— ç¬¬ä¸€ç±»ï¼šæ¶æ„å¤æ‚åº¦é—®é¢˜ï¼ˆèŒè´£æ··ä¹±ã€è€¦åˆåº¦é«˜ï¼‰"></a><strong>ğŸ”— ç¬¬ä¸€ç±»ï¼šæ¶æ„å¤æ‚åº¦é—®é¢˜ï¼ˆèŒè´£æ··ä¹±ã€è€¦åˆåº¦é«˜ï¼‰</strong></h4><h5 id="é—®é¢˜-1ï¼šè®¢é˜…åœ°ç‹±"><a href="#é—®é¢˜-1ï¼šè®¢é˜…åœ°ç‹±" class="headerlink" title="é—®é¢˜ 1ï¼šè®¢é˜…åœ°ç‹±"></a><strong>é—®é¢˜ 1ï¼šè®¢é˜…åœ°ç‹±</strong></h5><p>æ„é€ å‡½æ•°ä¸­ç¡¬ç¼–ç äº† 10+ ä¸ªè®¢é˜…ï¼Œä¿®æ”¹è¯é¢˜éœ€è¦æ”¹ä»£ç å¹¶é‡æ–°ç¼–è¯‘ï¼Œæ— æ³•çµæ´»é…ç½®ã€‚</p><p>æˆ‘ä¸€å¼€å§‹è§‰å¾—è¿™æ ·å†™æœ€ç›´æ¥â€”â€”æ‰€æœ‰è®¢é˜…éƒ½åœ¨ä¸€ä¸ªåœ°æ–¹ã€‚ä½†å½“æˆ‘æ·»åŠ ç¬¬ 5 ä¸ªæ¨¡å¼æ—¶ï¼Œæˆ‘æ„è¯†åˆ°è¿™ä¸ªæ„é€ å‡½æ•°å·²ç»æˆäº†â€æ„å¤§åˆ©é¢â€ã€‚</p><h5 id="é—®é¢˜-2ï¼šå·¨å¤§çš„-switch-case"><a href="#é—®é¢˜-2ï¼šå·¨å¤§çš„-switch-case" class="headerlink" title="é—®é¢˜ 2ï¼šå·¨å¤§çš„ switch-case"></a><strong>é—®é¢˜ 2ï¼šå·¨å¤§çš„ switch-case</strong></h5><p>å•ä¸ªå‡½æ•° &gt; 500 è¡Œï¼Œä¿®æ”¹ä¸€ä¸ªæ¨¡å¼å¯èƒ½å½±å“å…¶ä»–æ¨¡å¼ï¼Œmerge å†²çªé¢‘ç¹ã€‚</p><p>æˆ‘æ¯æ¬¡æ”¹ switch-case éƒ½è¦å°å¿ƒç¿¼ç¿¼ã€‚æ”¹äº†ä¸€ä¸ª caseï¼Œåˆå¾—æ‹…å¿ƒå¦ä¸€ä¸ª case æ˜¯å¦ä¼šå—å½±å“ã€‚åˆ°äº†ç¬¬ 10 ä¸ªæ¨¡å¼ï¼Œè¿™ä¸ªå‡½æ•°å·²ç»å¤§åˆ°æˆ‘æ ¹æœ¬ä¸æ•¢é‡æ„ã€‚</p><h5 id="é—®é¢˜-5ï¼šå…¨å±€çŠ¶æ€å˜é‡çˆ†ç‚¸"><a href="#é—®é¢˜-5ï¼šå…¨å±€çŠ¶æ€å˜é‡çˆ†ç‚¸" class="headerlink" title="é—®é¢˜ 5ï¼šå…¨å±€çŠ¶æ€å˜é‡çˆ†ç‚¸"></a><strong>é—®é¢˜ 5ï¼šå…¨å±€çŠ¶æ€å˜é‡çˆ†ç‚¸</strong></h5><p>20+ ä¸ªæˆå‘˜å˜é‡ç®¡ç†å„ç§çŠ¶æ€ï¼Œç«æ€æ¡ä»¶é£é™©é«˜ï¼Œéš¾ä»¥è·Ÿè¸ªçŠ¶æ€å˜åŒ–ã€‚</p><p>æ¯æ·»åŠ ä¸€ä¸ªæ–°æ¨¡å¼ï¼Œæˆ‘å°±è¦æ·»åŠ  5-10 ä¸ªæ–°çš„æˆå‘˜å˜é‡ã€‚ä»€ä¹ˆ <code>cartesian_thread_running_</code>ï¼Œ<code>stop_cartesian_thread_</code>ï¼Œ<code>active_twist_direction_</code> è¿™ç§ã€‚åˆ°æœ€åï¼Œæˆ‘ç”šè‡³ä¸çŸ¥é“è¿™äº›å˜é‡æ˜¯å¹²ä»€ä¹ˆçš„ã€‚</p><hr><h4 id="ğŸ”Œ-ç¬¬äºŒç±»ï¼šå¯æ‰©å±•æ€§é—®é¢˜ï¼ˆæ— æ³•é…ç½®ã€ä»£ç é‡å¤ï¼‰"><a href="#ğŸ”Œ-ç¬¬äºŒç±»ï¼šå¯æ‰©å±•æ€§é—®é¢˜ï¼ˆæ— æ³•é…ç½®ã€ä»£ç é‡å¤ï¼‰" class="headerlink" title="ğŸ”Œ ç¬¬äºŒç±»ï¼šå¯æ‰©å±•æ€§é—®é¢˜ï¼ˆæ— æ³•é…ç½®ã€ä»£ç é‡å¤ï¼‰"></a><strong>ğŸ”Œ ç¬¬äºŒç±»ï¼šå¯æ‰©å±•æ€§é—®é¢˜ï¼ˆæ— æ³•é…ç½®ã€ä»£ç é‡å¤ï¼‰</strong></h4><h5 id="é—®é¢˜-3ï¼šæ¶ˆæ¯ç±»å‹æ··ä¹±"><a href="#é—®é¢˜-3ï¼šæ¶ˆæ¯ç±»å‹æ··ä¹±" class="headerlink" title="é—®é¢˜ 3ï¼šæ¶ˆæ¯ç±»å‹æ··ä¹±"></a><strong>é—®é¢˜ 3ï¼šæ¶ˆæ¯ç±»å‹æ··ä¹±</strong></h5><p>æ¯ä¸ªæ¨¡å¼ç”¨ä¸åŒçš„æ¶ˆæ¯ç±»å‹ï¼Œæ²¡æœ‰ç»Ÿä¸€çš„æ¥å£ï¼Œå®¹æ˜“å‘é€é”™è¯¯çš„æ¶ˆæ¯ã€‚</p><p>JointVelocity è®¢é˜…çš„æ˜¯ <code>JointState</code>ï¼ŒCartesianVelocity è®¢é˜…çš„æ˜¯ <code>TwistStamped</code>ï¼ŒMoveJ è®¢é˜…çš„æ˜¯ <code>Float64MultiArray</code>ã€‚å®Œå…¨æ²¡æœ‰è§„å¾‹ã€‚æ–°æ¥çš„äººè¦æ·»åŠ ä¸€ä¸ªæ§åˆ¶å™¨ï¼Œè¿˜è¦å»ç¿»ä¹‹å‰çš„ä»£ç çŒœçŒœâ€åº”è¯¥ç”¨å“ªä¸ªæ¶ˆæ¯ç±»å‹â€ã€‚</p><h5 id="é—®é¢˜-6ï¼šæ— æ³•åŠ¨æ€é…ç½®"><a href="#é—®é¢˜-6ï¼šæ— æ³•åŠ¨æ€é…ç½®" class="headerlink" title="é—®é¢˜ 6ï¼šæ— æ³•åŠ¨æ€é…ç½®"></a><strong>é—®é¢˜ 6ï¼šæ— æ³•åŠ¨æ€é…ç½®</strong></h5><p>æ‰€æœ‰å‚æ•°ç¡¬ç¼–ç åœ¨ä»£ç ä¸­ï¼Œéƒ¨ç½²ä¸åŒçš„æœºå™¨äººéœ€è¦ä¿®æ”¹ä»£ç ã€‚</p><p>è¯é¢˜åæ­»æ­»åœ°å†™åœ¨ä»£ç é‡Œã€‚æƒ³åœ¨å¦ä¸€ä¸ªæœºå™¨äººä¸Šè·‘åŒæ ·çš„ä»£ç ï¼Ÿæ”¹è¯é¢˜åï¼Œé‡æ–°ç¼–è¯‘ã€‚æƒ³æ ¹æ®ä¸åŒçš„é…ç½®å¯ç”¨&#x2F;ç¦ç”¨æŸä¸ªæ¨¡å¼ï¼Ÿæ²¡åŠæ³•ï¼Œä»£ç é‡Œå·²ç»æ­»äº†ã€‚</p><h5 id="é—®é¢˜-7ï¼šæ¯ä¸ªæ¨¡å¼è‡ªå·±å®ç°çº¿ç¨‹ç®¡ç†"><a href="#é—®é¢˜-7ï¼šæ¯ä¸ªæ¨¡å¼è‡ªå·±å®ç°çº¿ç¨‹ç®¡ç†" class="headerlink" title="é—®é¢˜ 7ï¼šæ¯ä¸ªæ¨¡å¼è‡ªå·±å®ç°çº¿ç¨‹ç®¡ç†"></a><strong>é—®é¢˜ 7ï¼šæ¯ä¸ªæ¨¡å¼è‡ªå·±å®ç°çº¿ç¨‹ç®¡ç†</strong></h5><p>ä»£ç é‡å¤ï¼Œçº¿ç¨‹é¢‘ç‡ä¸ä¸€è‡´ï¼Œéš¾ä»¥ç»Ÿä¸€ç®¡ç†ç”Ÿå‘½å‘¨æœŸã€‚</p><p>CartesianVelocity ç”¨ <code>rclcpp::Rate(50)</code> å¾ªç¯ï¼ŒJointVelocity ç”¨ <code>std::this_thread::sleep_for(100ms)</code>ã€‚æ²¡äººè§„å®šåº”è¯¥æ€æ ·åšã€‚å¤åˆ¶ç²˜è´´å°±å®Œäº‹äº†ã€‚ç»“æœï¼šçº¿ç¨‹æ³„æ¼ã€æ­»é”ã€åŒæ­¥é—®é¢˜â€¦â€¦</p><hr><h4 id="ğŸ§ª-ç¬¬ä¸‰ç±»ï¼šå¯ç»´æŠ¤æ€§é—®é¢˜ï¼ˆèŒè´£æ··ä¹±ã€éš¾ä»¥æµ‹è¯•ï¼‰"><a href="#ğŸ§ª-ç¬¬ä¸‰ç±»ï¼šå¯ç»´æŠ¤æ€§é—®é¢˜ï¼ˆèŒè´£æ··ä¹±ã€éš¾ä»¥æµ‹è¯•ï¼‰" class="headerlink" title="ğŸ§ª ç¬¬ä¸‰ç±»ï¼šå¯ç»´æŠ¤æ€§é—®é¢˜ï¼ˆèŒè´£æ··ä¹±ã€éš¾ä»¥æµ‹è¯•ï¼‰"></a><strong>ğŸ§ª ç¬¬ä¸‰ç±»ï¼šå¯ç»´æŠ¤æ€§é—®é¢˜ï¼ˆèŒè´£æ··ä¹±ã€éš¾ä»¥æµ‹è¯•ï¼‰</strong></h4><h5 id="é—®é¢˜-4ï¼šä¸šåŠ¡é€»è¾‘ä¸åŸºç¡€è®¾æ–½æ··åˆ"><a href="#é—®é¢˜-4ï¼šä¸šåŠ¡é€»è¾‘ä¸åŸºç¡€è®¾æ–½æ··åˆ" class="headerlink" title="é—®é¢˜ 4ï¼šä¸šåŠ¡é€»è¾‘ä¸åŸºç¡€è®¾æ–½æ··åˆ"></a><strong>é—®é¢˜ 4ï¼šä¸šåŠ¡é€»è¾‘ä¸åŸºç¡€è®¾æ–½æ··åˆ</strong></h5><p>ä¸šåŠ¡é€»è¾‘ã€çº¿ç¨‹ç®¡ç†ã€ROS I&#x2F;O æ··åœ¨ä¸€èµ·ï¼Œæ— æ³•ç‹¬ç«‹æµ‹è¯•ã€‚</p><p>æƒ³å•ç‹¬æµ‹è¯• CartesianVelocityController çš„ IK è®¡ç®—ï¼Ÿä¸è¡Œï¼Œå®ƒå’Œçº¿ç¨‹ã€é”ã€çŠ¶æ€å˜é‡éƒ½æ··åœ¨ä¸€èµ·ã€‚æµ‹è¯•å®ƒå°±æ„å‘³ç€è¦å¯åŠ¨æ•´ä¸ª StateMachineã€åˆå§‹åŒ–æ‰€æœ‰ ROS é€šä¿¡ã€‚å•å…ƒæµ‹è¯•å˜æˆäº†â€é›†æˆæµ‹è¯•â€ã€‚</p><h5 id="é—®é¢˜-8ï¼šéš¾ä»¥æµ‹è¯•å’Œæ‰©å±•"><a href="#é—®é¢˜-8ï¼šéš¾ä»¥æµ‹è¯•å’Œæ‰©å±•" class="headerlink" title="é—®é¢˜ 8ï¼šéš¾ä»¥æµ‹è¯•å’Œæ‰©å±•"></a><strong>é—®é¢˜ 8ï¼šéš¾ä»¥æµ‹è¯•å’Œæ‰©å±•</strong></h5><p>æ— æ³•ç‹¬ç«‹å•å…ƒæµ‹è¯•æŸä¸ªæ§åˆ¶å™¨ï¼Œè€¦åˆå¤ªä¸¥é‡ã€‚</p><p>ä¸¤ä¸ªåŒäº‹è¦å¹¶è¡Œå¼€å‘ä¸¤ä¸ªæ–°æ¨¡å¼ï¼Ÿ10 åˆ†é’Ÿåå°±å¼€å§‹å‡ºç° merge å†²çªã€‚å› ä¸ºä»–ä»¬æ”¹çš„æ˜¯åŒä¸€ä¸ªæ–‡ä»¶çš„ä¸åŒéƒ¨åˆ†â€”â€”æ„é€ å‡½æ•°ã€switch-caseã€æˆå‘˜å˜é‡ã€‚ä¸€ä¸ªäººæ”¹äº†ï¼Œå¦ä¸€ä¸ªäººçš„ä»£ç å°±å¯èƒ½å’Œæ–°çš„éƒ¨åˆ†å†²çªã€‚</p><h3 id="1-3-é—®é¢˜çš„æ ¹æœ¬åŸå› "><a href="#1-3-é—®é¢˜çš„æ ¹æœ¬åŸå› " class="headerlink" title="1.3 é—®é¢˜çš„æ ¹æœ¬åŸå› "></a>1.3 é—®é¢˜çš„æ ¹æœ¬åŸå› </h3><p>è¿™ 8 ä¸ªé—®é¢˜çš„æ ¹æºä¸åœ¨å®ç°ç»†èŠ‚ï¼Œè€Œåœ¨<strong>æ¶æ„è®¾è®¡çš„ä¸¤ä¸ªæ ¸å¿ƒç¼ºé™·</strong>ï¼š</p><h4 id="ç¼ºé™·-Aï¼šä¸­å¿ƒåŒ–çš„â€ä¸‡èƒ½ç®¡ç†å™¨â€"><a href="#ç¼ºé™·-Aï¼šä¸­å¿ƒåŒ–çš„â€ä¸‡èƒ½ç®¡ç†å™¨â€" class="headerlink" title="ç¼ºé™· Aï¼šä¸­å¿ƒåŒ–çš„â€ä¸‡èƒ½ç®¡ç†å™¨â€"></a><strong>ç¼ºé™· Aï¼šä¸­å¿ƒåŒ–çš„â€ä¸‡èƒ½ç®¡ç†å™¨â€</strong></h4><p>æ‰€æœ‰æ§åˆ¶é€»è¾‘ã€æ¶ˆæ¯å¤„ç†ã€çº¿ç¨‹ç®¡ç†éƒ½é›†ä¸­åœ¨ StateMachine ä¸€ä¸ªç±»ä¸­ã€‚ä»»ä½•æ”¹åŠ¨éƒ½å½±å“æ•´ä¸ªç³»ç»Ÿã€‚</p><h4 id="ç¼ºé™·-Bï¼šç¡¬ç¼–ç è€Œéé…ç½®é©±åŠ¨"><a href="#ç¼ºé™·-Bï¼šç¡¬ç¼–ç è€Œéé…ç½®é©±åŠ¨" class="headerlink" title="ç¼ºé™· Bï¼šç¡¬ç¼–ç è€Œéé…ç½®é©±åŠ¨"></a><strong>ç¼ºé™· Bï¼šç¡¬ç¼–ç è€Œéé…ç½®é©±åŠ¨</strong></h4><p>æ·»åŠ æ–°æ¨¡å¼éœ€è¦ä¿®æ”¹ä»£ç çš„å¤šä¸ªä½ç½®ï¼Œä»»ä½•é…ç½®æ”¹åŠ¨éƒ½éœ€è¦é‡æ–°ç¼–è¯‘ã€‚</p><p><strong>å…³é”®æ´å¯Ÿ</strong>ï¼šè¿™ä¸æ˜¯å†™æ³•é—®é¢˜ï¼Œè€Œæ˜¯æ¶æ„è®¾è®¡çš„é—®é¢˜ã€‚è„æ¶æ„çš„æœ¬è´¨ç¼ºé™·æ˜¯<strong>æ²¡æœ‰æ¸…æ™°çš„èŒè´£è¾¹ç•Œ</strong>ã€‚</p><p><strong>è„æ¶æ„çš„æœ¬è´¨</strong>ï¼š</p><ul><li>âŒ èƒ½å·¥ä½œï¼ˆçŸ­æœŸï¼‰âœ“</li><li>âŒ æ— æ³•æˆé•¿ï¼ˆé•¿æœŸï¼‰âœ—</li><li>âŒ æ— æ³•é¢„æµ‹ï¼ˆä¿®æ”¹ä¸€å¤„ï¼Œä¸çŸ¥é“ä¼šå¦å½±å“å¦ä¸€å¤„ï¼‰</li></ul><p><strong>æˆ‘ä»¬æœŸå¾…çš„ç†æƒ³çŠ¶æ€</strong>ï¼ˆæ¸…æ´æ¶æ„ï¼‰ï¼š</p><ul><li>âœ“ æ·»åŠ æ–°æ§åˆ¶å™¨ï¼Œæ— éœ€ä¿®æ”¹æ ¸å¿ƒä»£ç </li><li>âœ“ é…ç½®æ–‡ä»¶èƒ½é©±åŠ¨ç³»ç»Ÿè¡Œä¸º</li><li>âœ“ é€šä¿¡é€»è¾‘ä¸æ§åˆ¶é€»è¾‘å®Œå…¨è§£è€¦</li><li>âœ“ æ¯ä¸ªæ§åˆ¶å™¨å¯ç‹¬ç«‹æµ‹è¯•</li></ul><p>è¿™ï¼Œå°±æ˜¯æˆ‘ä»¬è¦åœ¨ä¸‹ç¯‡å®ç°çš„ç›®æ ‡ã€‚</p><hr><h2 id="ç¬¬ä¸€éƒ¨åˆ†ï¼ˆç»­ï¼‰ï¼š8-ä¸ªé—®é¢˜é€Ÿè§ˆ"><a href="#ç¬¬ä¸€éƒ¨åˆ†ï¼ˆç»­ï¼‰ï¼š8-ä¸ªé—®é¢˜é€Ÿè§ˆ" class="headerlink" title="ç¬¬ä¸€éƒ¨åˆ†ï¼ˆç»­ï¼‰ï¼š8 ä¸ªé—®é¢˜é€Ÿè§ˆ"></a>ç¬¬ä¸€éƒ¨åˆ†ï¼ˆç»­ï¼‰ï¼š8 ä¸ªé—®é¢˜é€Ÿè§ˆ</h2><p>ç”¨ä¸€å¼ è¡¨å¿«é€Ÿæ€»ç»“è„æ¶æ„çš„å…¨è²Œï¼š</p><table><thead><tr><th>åºå·</th><th>é—®é¢˜å</th><th>è¡¨ç°</th><th>æ ¹æœ¬åŸå› </th></tr></thead><tbody><tr><td>1ï¸âƒ£</td><td>è®¢é˜…åœ°ç‹±</td><td>æ„é€ å‡½æ•° 10+ ä¸ªç¡¬ç¼–ç è®¢é˜…ï¼Œä¿®æ”¹è¯é¢˜éœ€æ”¹ä»£ç é‡ç¼–è¯‘</td><td>æ²¡æœ‰é…ç½®æ–‡ä»¶æ”¯æŒ</td></tr><tr><td>2ï¸âƒ£</td><td>å·¨å¤§ switch-case</td><td>500+ è¡Œçš„å•ä¸€å‡½æ•°ï¼Œé€»è¾‘æ··ä¹±ï¼Œmerge å†²çªé¢‘ç¹</td><td>æ²¡æœ‰å·¥å‚æ¨¡å¼åˆ†ç¦»é€»è¾‘</td></tr><tr><td>3ï¸âƒ£</td><td>æ¶ˆæ¯ç±»å‹æ··ä¹±</td><td>æ¯ä¸ªæ¨¡å¼ç”¨ä¸åŒæ¶ˆæ¯ç±»å‹ï¼Œæ— æ³•ç»Ÿä¸€æ¥å£</td><td>æ²¡æœ‰åŸºç±»æ¥å£çº¦æŸ</td></tr><tr><td>4ï¸âƒ£</td><td>é€»è¾‘ä¸åŸºç¡€è®¾æ–½æ··åˆ</td><td>ä¸šåŠ¡é€»è¾‘ + çº¿ç¨‹ç®¡ç† + ROS I&#x2F;O æ··åœ¨ä¸€èµ·</td><td>æ²¡æœ‰èŒè´£åˆ†ç¦»ï¼ˆSRPï¼‰</td></tr><tr><td>5ï¸âƒ£</td><td>çŠ¶æ€å˜é‡çˆ†ç‚¸</td><td>20+ ä¸ªæˆå‘˜å˜é‡ç®¡ç†å„ç§çŠ¶æ€ï¼Œç«æ€æ¡ä»¶é£é™©é«˜</td><td>æ²¡æœ‰çŠ¶æ€å°è£…è¾¹ç•Œ</td></tr><tr><td>6ï¸âƒ£</td><td>æ— æ³•åŠ¨æ€é…ç½®</td><td>æ‰€æœ‰å‚æ•°ç¡¬ç¼–ç ï¼Œæ— æ³•å‚æ•°åŒ–éƒ¨ç½²</td><td>æ²¡æœ‰é…ç½®é©±åŠ¨è®¾è®¡</td></tr><tr><td>7ï¸âƒ£</td><td>çº¿ç¨‹ç®¡ç†é‡å¤</td><td>æ¯ä¸ªæ¨¡å¼è‡ªå·±å®ç°çº¿ç¨‹å¾ªç¯ï¼Œä»£ç é‡å¤é«˜</td><td>æ²¡æœ‰ç»Ÿä¸€çš„çº¿ç¨‹æŠ½è±¡</td></tr><tr><td>8ï¸âƒ£</td><td>éš¾ä»¥æµ‹è¯•å’Œæ‰©å±•</td><td>æ— æ³•ç‹¬ç«‹å•å…ƒæµ‹è¯•æŸä¸ªæ§åˆ¶å™¨</td><td>è€¦åˆå¤ªä¸¥é‡ï¼Œæ— æ³•éš”ç¦»</td></tr></tbody></table><p><strong>ä¸€å¥è¯æ€»ç»“</strong>ï¼šæ‰€æœ‰é—®é¢˜éƒ½æºäºåŒä¸€ä¸ªæ ¹å› â€”â€”<strong>èŒè´£æ²¡æœ‰æ¸…æ™°è¾¹ç•Œï¼Œæ‰€æœ‰ä¸œè¥¿æ··åœ¨ä¸€ä¸ªæ–‡ä»¶é‡Œ</strong>ã€‚</p><hr><h2 id="ç¬¬ä¸€éƒ¨åˆ†ï¼ˆç»­ï¼‰ï¼šè„æ¶æ„çš„ç—‡çŠ¶æ€»ç»“"><a href="#ç¬¬ä¸€éƒ¨åˆ†ï¼ˆç»­ï¼‰ï¼šè„æ¶æ„çš„ç—‡çŠ¶æ€»ç»“" class="headerlink" title="ç¬¬ä¸€éƒ¨åˆ†ï¼ˆç»­ï¼‰ï¼šè„æ¶æ„çš„ç—‡çŠ¶æ€»ç»“"></a>ç¬¬ä¸€éƒ¨åˆ†ï¼ˆç»­ï¼‰ï¼šè„æ¶æ„çš„ç—‡çŠ¶æ€»ç»“</h2><p>éšç€æ§åˆ¶å™¨æ•°é‡å¢åŠ ï¼Œè„æ¶æ„çš„ä»£ä»·æŒ‡æ•°çº§å¢é•¿ï¼š</p><table><thead><tr><th>æ§åˆ¶å™¨æ•°é‡</th><th>æ ¸å¿ƒæ–‡ä»¶è¡Œæ•°</th><th>æ¯ä¸ªæ§åˆ¶å™¨æˆæœ¬</th><th>ç»´æŠ¤éš¾åº¦</th><th>çŠ¶æ€</th></tr></thead><tbody><tr><td>1-5 ä¸ª</td><td>300-800 è¡Œ</td><td>2-4 å°æ—¶</td><td>â­ ç®€å•</td><td>âœ“ å¯æ¥å—</td></tr><tr><td>5-10 ä¸ª</td><td>800-1500 è¡Œ</td><td>4-8 å°æ—¶</td><td>â­â­â­ ä¸­ç­‰</td><td>âœ“ è¿˜èƒ½æ¥å—</td></tr><tr><td>10-20 ä¸ª</td><td>1500-3000 è¡Œ</td><td>8-24 å°æ—¶</td><td>â­â­â­â­â­ å›°éš¾</td><td>âš ï¸ éœ€è¦é‡æ„</td></tr><tr><td>20+ ä¸ª</td><td>3000+ è¡Œ</td><td>24-72 å°æ—¶</td><td>â­â­â­â­â­â­ æéš¾</td><td>âŒ ä¸å¯ç»´æŠ¤</td></tr></tbody></table><p><strong>å…³é”®è§‚å¯Ÿ</strong>ï¼š</p><ul><li>æ ¸å¿ƒæ–‡ä»¶è¡Œæ•°å‘ˆ<strong>çº¿æ€§å¢é•¿</strong>ï¼ˆæ¯ä¸ªæ–°æ§åˆ¶å™¨æ·»åŠ  150-200 è¡Œï¼‰</li><li>æ·»åŠ æ–°æ§åˆ¶å™¨çš„æˆæœ¬å‘ˆ<strong>æŒ‡æ•°å¢é•¿</strong>ï¼ˆä» 2h â†’ 4h â†’ 8h â†’ 24hï¼‰</li><li>merge å†²çªä»å¶å‘ â†’ é¢‘ç¹ â†’ æ¯æ¬¡éƒ½æœ‰</li></ul><p>å½“ä½ è¶…è¿‡ 20 ä¸ªæ§åˆ¶å™¨æ—¶ï¼Œæ•´ä¸ªç³»ç»Ÿå·²ç»åŸºæœ¬ä¸å¯ç»´æŠ¤ã€‚</p><hr><p><a id="solid-principles"></a></p><h2 id="ç¬¬äºŒéƒ¨åˆ†-åº•å±‚ç†è®º-SOLID-åŸåˆ™åœ¨æœ¬é¡¹ç›®ä¸­çš„åº”ç”¨"><a href="#ç¬¬äºŒéƒ¨åˆ†-åº•å±‚ç†è®º-SOLID-åŸåˆ™åœ¨æœ¬é¡¹ç›®ä¸­çš„åº”ç”¨" class="headerlink" title="ç¬¬äºŒéƒ¨åˆ† - åº•å±‚ç†è®º - SOLID åŸåˆ™åœ¨æœ¬é¡¹ç›®ä¸­çš„åº”ç”¨"></a>ç¬¬äºŒéƒ¨åˆ† - åº•å±‚ç†è®º - SOLID åŸåˆ™åœ¨æœ¬é¡¹ç›®ä¸­çš„åº”ç”¨</h2><p>æ¸…æ´è®¾è®¡ä¹‹æ‰€ä»¥æœ‰æ•ˆï¼Œæ˜¯å› ä¸ºå®ƒéµå¾ªäº† SOLID è®¾è®¡åŸåˆ™ã€‚ç†è§£è¿™äº›åŸåˆ™èƒ½å¸®åŠ©æˆ‘ä»¬çœ‹æ¸…è„æ¶æ„<strong>ä¸ºä»€ä¹ˆ</strong>å‡ºç°è¿™äº›é—®é¢˜ã€‚</p><h3 id="S-å•ä¸€èŒè´£åŸåˆ™ï¼ˆSingle-Responsibility-Principleï¼‰"><a href="#S-å•ä¸€èŒè´£åŸåˆ™ï¼ˆSingle-Responsibility-Principleï¼‰" class="headerlink" title="S - å•ä¸€èŒè´£åŸåˆ™ï¼ˆSingle Responsibility Principleï¼‰"></a><strong>S - å•ä¸€èŒè´£åŸåˆ™ï¼ˆSingle Responsibility Principleï¼‰</strong></h3><p><strong>åŸåˆ™</strong>ï¼šä¸€ä¸ªç±»åº”è¯¥åªæœ‰ä¸€ä¸ªæ”¹å˜çš„ç†ç”±ã€‚</p><p><strong>è„æ¶æ„çš„è¿å</strong>ï¼š</p><ul><li>StateMachine ç±»åŒæ—¶è´Ÿè´£ï¼šROS é€šä¿¡ã€æ¨¡å¼åˆ‡æ¢ã€ä¸šåŠ¡é€»è¾‘ã€çº¿ç¨‹ç®¡ç†ã€çŠ¶æ€ç»´æŠ¤</li><li>ä¿®æ”¹ä»»ä½•ä¸€ä¸ªæ–¹é¢éƒ½è¦æ”¹è¿™ä¸ªç±»</li></ul><p><strong>æ”¶ç›Š</strong>ï¼š</p><ul><li>ä¿®æ”¹æŸä¸ªæ§åˆ¶å™¨çš„é€»è¾‘ï¼Œä¸å½±å“ ControllerManager</li><li>ä»£ç å¤ç”¨æ€§é«˜ï¼Œæ˜“äºæµ‹è¯•</li></ul><h3 id="O-å¼€é—­åŸåˆ™ï¼ˆOpen-Closed-Principleï¼‰"><a href="#O-å¼€é—­åŸåˆ™ï¼ˆOpen-Closed-Principleï¼‰" class="headerlink" title="O - å¼€é—­åŸåˆ™ï¼ˆOpen&#x2F;Closed Principleï¼‰"></a><strong>O - å¼€é—­åŸåˆ™ï¼ˆOpen&#x2F;Closed Principleï¼‰</strong></h3><p><strong>åŸåˆ™</strong>ï¼šè½¯ä»¶åº”è¯¥å¯¹æ‰©å±•å¼€æ”¾ï¼Œå¯¹ä¿®æ”¹å…³é—­ã€‚</p><p><strong>è„æ¶æ„çš„è¿å</strong>ï¼š</p><ul><li>æ·»åŠ æ–°æ¨¡å¼ â†’ å¿…é¡»ä¿®æ”¹ StateMachine ç±»</li><li>æ¯æ¬¡æ‰©å±•éƒ½è¦æ”¹ç°æœ‰ä»£ç </li></ul><p><strong>æ”¶ç›Š</strong>ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">è„æ¶æ„ï¼šæ‰©å±• = ä¿®æ”¹æ ¸å¿ƒæ–‡ä»¶ï¼Œé£é™©é«˜</span><br><span class="line">æ¸…æ´è®¾è®¡ï¼šæ‰©å±• = æ·»åŠ æ–°æ–‡ä»¶ï¼Œé£é™©ä½</span><br></pre></td></tr></table></figure><h3 id="L-é‡Œæ°æ›¿æ¢åŸåˆ™ï¼ˆLiskov-Substitution-Principleï¼‰"><a href="#L-é‡Œæ°æ›¿æ¢åŸåˆ™ï¼ˆLiskov-Substitution-Principleï¼‰" class="headerlink" title="L - é‡Œæ°æ›¿æ¢åŸåˆ™ï¼ˆLiskov Substitution Principleï¼‰"></a><strong>L - é‡Œæ°æ›¿æ¢åŸåˆ™ï¼ˆLiskov Substitution Principleï¼‰</strong></h3><p><strong>åŸåˆ™</strong>ï¼šå­ç±»åº”è¯¥å¯ä»¥æ›¿ä»£çˆ¶ç±»ï¼Œè€Œä¸ä¼šå¯¼è‡´ç¨‹åºå‡ºé”™ã€‚</p><p><strong>è„æ¶æ„çš„è¿å</strong>ï¼š</p><ul><li>æ²¡æœ‰ç»Ÿä¸€çš„æ¥å£ï¼Œæ¯ä¸ªæ§åˆ¶å™¨å®ç°éƒ½ä¸åŒ</li></ul><p><strong>æ”¶ç›Š</strong>ï¼š</p><ul><li>å¯ä»¥è½»æ¾æ›¿æ¢æ§åˆ¶å™¨å®ç°</li><li>ControllerManager ä»£ç æ°¸ä¸ä¿®æ”¹</li></ul><h3 id="I-æ¥å£éš”ç¦»åŸåˆ™ï¼ˆInterface-Segregation-Principleï¼‰"><a href="#I-æ¥å£éš”ç¦»åŸåˆ™ï¼ˆInterface-Segregation-Principleï¼‰" class="headerlink" title="I - æ¥å£éš”ç¦»åŸåˆ™ï¼ˆInterface Segregation Principleï¼‰"></a><strong>I - æ¥å£éš”ç¦»åŸåˆ™ï¼ˆInterface Segregation Principleï¼‰</strong></h3><p><strong>åŸåˆ™</strong>ï¼šå®¢æˆ·ç«¯ä¸åº”è¯¥è¢«è¿«ä¾èµ–å®ƒä¸ä½¿ç”¨çš„æ¥å£ã€‚</p><p><strong>è„æ¶æ„çš„è¿å</strong>ï¼š</p><ul><li>StateMachine ä¾èµ– ROSã€Kinematicsã€HardwareManager ç­‰æ‰€æœ‰ç³»ç»Ÿ</li><li>ä¿®æ”¹ä»»ä½•ä¾èµ–éƒ½è¦æ”¹ StateMachine</li></ul><p><strong>æ”¶ç›Š</strong>ï¼š</p><ul><li>ä¿®æ”¹ Kinematics â†’ åªå½±å“ CartesianVelocityController</li><li>ControllerManager å®Œå…¨ä¸å—å½±å“</li></ul><h3 id="D-ä¾èµ–å€’ç½®åŸåˆ™ï¼ˆDependency-Inversion-Principleï¼‰"><a href="#D-ä¾èµ–å€’ç½®åŸåˆ™ï¼ˆDependency-Inversion-Principleï¼‰" class="headerlink" title="D - ä¾èµ–å€’ç½®åŸåˆ™ï¼ˆDependency Inversion Principleï¼‰"></a><strong>D - ä¾èµ–å€’ç½®åŸåˆ™ï¼ˆDependency Inversion Principleï¼‰</strong></h3><p><strong>åŸåˆ™</strong>ï¼šé«˜å±‚æ¨¡å—ä¸åº”è¯¥ä¾èµ–ä½å±‚æ¨¡å—ï¼Œä¸¤è€…éƒ½åº”è¯¥ä¾èµ–æŠ½è±¡ã€‚</p><p><strong>è„æ¶æ„çš„è¿å</strong>ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">é«˜å±‚ï¼ˆStateMachineï¼‰</span><br><span class="line">    â†“ ç›´æ¥ä¾èµ–</span><br><span class="line">ä½å±‚ï¼ˆå…·ä½“æ§åˆ¶é€»è¾‘ï¼‰</span><br></pre></td></tr></table></figure><p><strong>æ¸…æ´è®¾è®¡çš„æ–¹å‘</strong>ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">é«˜å±‚ï¼ˆControllerManagerï¼‰</span><br><span class="line">    â†“ ä¾èµ–</span><br><span class="line">æŠ½è±¡ï¼ˆModeControllerBase æ¥å£ï¼‰</span><br><span class="line">    â†“ ä¾èµ–</span><br><span class="line">ä½å±‚ï¼ˆå…·ä½“æ§åˆ¶å™¨å®ç°ï¼‰</span><br></pre></td></tr></table></figure><h3 id="SOLID-åŸåˆ™å¯¹æ¯”è¡¨"><a href="#SOLID-åŸåˆ™å¯¹æ¯”è¡¨" class="headerlink" title="SOLID åŸåˆ™å¯¹æ¯”è¡¨"></a>SOLID åŸåˆ™å¯¹æ¯”è¡¨</h3><table><thead><tr><th>åŸåˆ™</th><th>è„æ¶æ„é—®é¢˜</th><th>æ¸…æ´è®¾è®¡åº”ç”¨</th><th>æ”¶ç›Š</th></tr></thead><tbody><tr><td><strong>S</strong> å•ä¸€èŒè´£</td><td>StateMachine è´Ÿè´£æ‰€æœ‰</td><td>æ¯ä¸ªç±»åªåšä¸€ä»¶äº‹</td><td>ä¿®æ”¹éš”ç¦»ã€æ˜“äºæµ‹è¯•</td></tr><tr><td><strong>O</strong> å¼€é—­</td><td>æ‰©å±•&#x3D;ä¿®æ”¹æ ¸å¿ƒæ–‡ä»¶</td><td>æ‰©å±•&#x3D;æ·»åŠ æ–°æ–‡ä»¶</td><td>é£é™©ä½ã€æˆæœ¬æ’å®š</td></tr><tr><td><strong>L</strong> é‡Œæ°æ›¿æ¢</td><td>æ¥å£ä¸ç»Ÿä¸€</td><td>ç»Ÿä¸€çš„ ModeControllerBase</td><td>å¯éšæ„æ›¿æ¢</td></tr><tr><td><strong>I</strong> æ¥å£éš”ç¦»</td><td>æ‰€æœ‰ä¾èµ–æ··åœ¨ä¸€èµ·</td><td>åˆ†å±‚éš”ç¦»ä¾èµ–</td><td>æ”¹åŠ¨å½±å“å°</td></tr><tr><td><strong>D</strong> ä¾èµ–å€’ç½®</td><td>é«˜å±‚ä¾èµ–ä½å±‚</td><td>éƒ½ä¾èµ–æŠ½è±¡</td><td>æ¾è€¦åˆã€æ˜“æ‰©å±•</td></tr></tbody></table><h3 id="ä¸ºä»€ä¹ˆ-SOLID-åŸåˆ™å¾ˆé‡è¦"><a href="#ä¸ºä»€ä¹ˆ-SOLID-åŸåˆ™å¾ˆé‡è¦" class="headerlink" title="ä¸ºä»€ä¹ˆ SOLID åŸåˆ™å¾ˆé‡è¦"></a>ä¸ºä»€ä¹ˆ SOLID åŸåˆ™å¾ˆé‡è¦</h3><p>SOLID åŸåˆ™ä¸æ˜¯â€æœ€ä½³å®è·µâ€çš„æ„è§ï¼Œè€Œæ˜¯ç»è¿‡å‡ åå¹´éªŒè¯çš„å·¥ç¨‹åŸåˆ™ã€‚å½“ä½ éµå¾ªè¿™äº›åŸåˆ™æ—¶ï¼š</p><ol><li><strong>ä»£ç å˜å¾—å¯æŒç»­æ¼”åŒ–</strong> - æ·»åŠ åŠŸèƒ½æˆæœ¬æ’å®š</li><li><strong>å›¢é˜Ÿå¯ä»¥å¹¶è¡Œå·¥ä½œ</strong> - ä¸ä¼šé¢‘ç¹å†²çª</li><li><strong>bug ä¿®å¤é£é™©ä½</strong> - ä¿®æ”¹éš”ç¦»åœ¨å°èŒƒå›´å†…</li><li><strong>æ–°æˆå‘˜æ˜“ä¸Šæ‰‹</strong> - æ¨¡å—åŒ–çš„ä»£ç æ›´å®¹æ˜“ç†è§£</li><li><strong>æµ‹è¯•å˜å¾—å¯è¡Œ</strong> - è§£è€¦çš„ä»£ç æ˜“äºå•å…ƒæµ‹è¯•</li></ol><p>è¿™äº›ä¸ä»…ä»…æ˜¯â€ä»£ç ç¾è§‚â€çš„é—®é¢˜ï¼Œè€Œæ˜¯å½±å“æ•´ä¸ªé¡¹ç›®ç”Ÿå‘½å‘¨æœŸæˆæœ¬çš„å·¥ç¨‹å†³ç­–ã€‚</p><p><strong>ä¸€å¥è¯æ€»ç»“</strong>ï¼š</p><blockquote><p>å¦‚æœä½ æƒ³è®©ç³»ç»Ÿèƒ½ä¸æ–­æ·»åŠ æ§åˆ¶å™¨è€Œä¸è§¦ç¢°æ—§ä»£ç ï¼Œå°±å¿…é¡»éµå®ˆ SOLIDâ€”â€”ç‰¹åˆ«æ˜¯å¼€é—­åŸåˆ™å’Œä¾èµ–å€’ç½®åŸåˆ™ã€‚</p></blockquote><hr><h2 id="æ€»ç»“ï¼šé—®é¢˜è¯Šæ–­å®Œæˆ"><a href="#æ€»ç»“ï¼šé—®é¢˜è¯Šæ–­å®Œæˆ" class="headerlink" title="æ€»ç»“ï¼šé—®é¢˜è¯Šæ–­å®Œæˆ"></a>æ€»ç»“ï¼šé—®é¢˜è¯Šæ–­å®Œæˆ</h2><p>ç°åœ¨æˆ‘ä»¬æ¸…æ¥šåœ°çœ‹åˆ°äº†è„æ¶æ„çš„ 8 ä¸ªä¸¥é‡é—®é¢˜ï¼Œä»¥åŠå®ƒä»¬çš„æ ¹æœ¬åŸå› â€”â€”<strong>èŒè´£æ··ä¹±å’Œè¿‡åº¦è€¦åˆ</strong>ã€‚</p><p>è¿™äº›é—®é¢˜éƒ½è¿åäº† SOLID åŸåˆ™ï¼Œç‰¹åˆ«æ˜¯ï¼š</p><ul><li><strong>å•ä¸€èŒè´£åŸåˆ™</strong>ï¼šStateMachine èŒè´£å¤ªå¤š</li><li><strong>å¼€é—­åŸåˆ™</strong>ï¼šæ¯æ¬¡æ‰©å±•éƒ½è¦ä¿®æ”¹æ ¸å¿ƒä»£ç </li><li><strong>æ¥å£éš”ç¦»åŸåˆ™</strong>ï¼šæ‰€æœ‰ä¾èµ–æ··åœ¨ä¸€èµ·</li><li><strong>ä¾èµ–å€’ç½®åŸåˆ™</strong>ï¼šé«˜å±‚ç›´æ¥ä¾èµ–ä½å±‚å®ç°</li></ul><hr><h2 id="ä¸‹ä¸€æ­¥ï¼šæ¸…æ´è®¾è®¡çš„è§£å†³æ–¹æ¡ˆ"><a href="#ä¸‹ä¸€æ­¥ï¼šæ¸…æ´è®¾è®¡çš„è§£å†³æ–¹æ¡ˆ" class="headerlink" title="ä¸‹ä¸€æ­¥ï¼šæ¸…æ´è®¾è®¡çš„è§£å†³æ–¹æ¡ˆ"></a>ä¸‹ä¸€æ­¥ï¼šæ¸…æ´è®¾è®¡çš„è§£å†³æ–¹æ¡ˆ</h2><p>åœ¨<strong>ä¸‹ç¯‡</strong>ä¸­ï¼Œæˆ‘ä»¬å°†çœ‹åˆ°å¦‚ä½•é€šè¿‡ï¼š</p><ol><li><strong>åˆ†ç¦»èŒè´£</strong> - æ¯ä¸ªæ§åˆ¶å™¨ç‹¬ç«‹æˆç±»</li><li><strong>é…ç½®é©±åŠ¨</strong> - YAML æ–‡ä»¶è€Œéç¡¬ç¼–ç </li><li><strong>å·¥å‚æ¨¡å¼</strong> - åŠ¨æ€åˆ›å»ºæ§åˆ¶å™¨</li><li><strong>ç»Ÿä¸€æ¥å£</strong> - æ‰€æœ‰æ§åˆ¶å™¨å®ç°åŒä¸€ä¸ªæ¥å£</li></ol><p>æ¥å®Œå…¨è§£å†³è¿™äº›é—®é¢˜ã€‚ä¸‹ç¯‡å°†æ·±å…¥è®²è§£æ¸…æ´è®¾è®¡çš„å®ç°ç»†èŠ‚å’Œä»£ç ç¤ºä¾‹ã€‚</p><p><strong>ä¸‹ç¯‡é“¾æ¥</strong>ï¼š<a href="/2025/11/01/%E4%BB%8E%E7%A1%AC%E7%BC%96%E7%A0%81%E5%88%B0%E6%8F%92%E4%BB%B6%E5%8C%96%EF%BC%88%E4%B8%8B%E7%AF%87%EF%BC%89%EF%BC%9A%E6%B8%85%E6%B4%81%E6%9E%B6%E6%9E%84%E7%9A%84%E8%AE%BE%E8%AE%A1%E4%B8%8E%E5%AE%9E%E7%8E%B0/">ä»ç¡¬ç¼–ç åˆ°æ’ä»¶åŒ–ï¼ˆä¸‹ç¯‡ï¼‰ï¼šæ¸…æ´æ¶æ„çš„è®¾è®¡ä¸å®ç°</a></p>]]></content>
    
    
    <summary type="html">æœ¬æ–‡è®°å½•æˆ‘åœ¨é‡æ„æœºå™¨äººæ§åˆ¶ç³»ç»Ÿæ—¶é‡åˆ°çš„â€œè„æ¶æ„â€é—®é¢˜ï¼Œåˆ†æå®ƒä¸ºä½•éš¾ä»¥æ‰©å±•ã€éš¾ä»¥ç»´æŠ¤ï¼Œä¸ºä¸‹ç¯‡çš„æ¸…æ´è®¾è®¡é“ºå«åŸºç¡€ã€‚</summary>
    
    
    
    <category term="æ§åˆ¶æ¶æ„ç¯‡-ä»æ¨¡å¼åˆ°å·¥å‚" scheme="http://ding-kaiyue.github.io/categories/%E6%8E%A7%E5%88%B6%E6%9E%B6%E6%9E%84%E7%AF%87-%E4%BB%8E%E6%A8%A1%E5%BC%8F%E5%88%B0%E5%B7%A5%E5%8E%82/"/>
    
    
    <category term="C++" scheme="http://ding-kaiyue.github.io/tags/C/"/>
    
    <category term="ROS2" scheme="http://ding-kaiyue.github.io/tags/ROS2/"/>
    
    <category term="è®¾è®¡æ¨¡å¼" scheme="http://ding-kaiyue.github.io/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"/>
    
    <category term="æ§åˆ¶ç³»ç»Ÿæ¶æ„" scheme="http://ding-kaiyue.github.io/tags/%E6%8E%A7%E5%88%B6%E7%B3%BB%E7%BB%9F%E6%9E%B6%E6%9E%84/"/>
    
    <category term="æ’ä»¶åŒ–" scheme="http://ding-kaiyue.github.io/tags/%E6%8F%92%E4%BB%B6%E5%8C%96/"/>
    
  </entry>
  
</feed>
